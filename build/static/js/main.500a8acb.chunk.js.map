{"version":3,"sources":["Components/Modal/ModalContent.js","Components/Modal/ModalTrigger.js","Components/Modal/Modal.js","lib/Sadface.js","Components/Menu/Menu.js","Components/Menu/MenuTrigger.js","Components/ResourcePane/ResourceBody/ResourceBody.js","Components/ResourcePane/ResourceHead/ResourcePane.js","Components/VisualisationPane/VisualisationPane.js","App.js","serviceWorker.js","index.js"],"names":["ModalContent","props","state","buttons","this","content","footer","buttonNo","className","ref","buttonRef","aria-label","aria-labelledby","onClick","closeModal","type","button1","value","button2","data-dismiss","class","ReactDOM","createPortal","tag","role","tabIndex","aria-modal","onClickOutside","onKeyDown","id","modalRef","title","renderButtons","document","body","Component","ModalTrigger","style","display","showModal","triggerText","Modal","setState","isShown","closeButton","focus","toggleScrollLock","TriggerButton","event","keyCode","modal","contains","target","querySelector","classList","toggle","actionAndClose","Fragment","n","modalProps","trigger","triggerId","show","modalTitle","sd","resources","nodes","edges","f_name","add_edge","source_id","target_id","get_node","edge","new_uuid","new_edge","push","add_atom","text","atom","new_atom","add_resource","res","new_resource","add_scheme","name","scheme","new_scheme","add_source","atom_id","resource_id","offset","length","undefined","source","new_source","forEach","node","sources","delete_edge","edge_id","del_edge","size","Object","keys","i","get_edge","remove_falsy","delete_source","sourced","get_atom","get_source","export_cytoscape","sadface","console","log","cy","e","data","classes","typeshape","JSON","stringify","node_id","get_resource","resource","get_scheme","scheme_id","import_json","json_string","parse","replace","c","crypto","getRandomValues","Uint8Array","toString","now","Date","toISOString","split","saveSADFace","filename","filetype","f","indexof","txt","join","long_string","max_char","sum_length_of_words","word_array","out","split_out","split_string","word","concat","textwrap","format","doc","string","prettyprint","download","outfile","createElement","setAttribute","encodeURIComponent","appendChild","click","removeChild","update_resource","metadata","get_sd","obj","newObj","prop","Menu","pngRef","React","createRef","jpgRef","loadJSONRef","mp_reset","bind","download_png","download_jpg","download_sadface","handleFileName","handleSADfaceUpload","SADfaceUpload","localStorage","clear","window","location","reload","analystname","analyst_name","analystemail","analyst_email","fileName","current","fileManager","file_name","setFileName","newFile","files","resetConfirmModal","href","rel","variant","children","toggleResourcePane","load_demo_argument","rows","cols","maxLength","resize","placeholder","onChange","handle_set_analyst_name","handle_set_analyst_email","png","jpg","accept","MenuTrigger","color","TabBody","readOnly","toggle_edit_lock","handleGetSelectedText","handleFocus","getSelection","select","setSelectedText","setFocus","handleremove","handleFileDownload","clickLoad","contentValue","titleValue","loadTxtRef","titleRef","handleFileUpload","handleChange_title","handleChangeContent","handleAddAtomFromText","disabled","selectedText","setTextInputRef","minHeight","onMouseUp","onFocus","ResourcePane","resourceType","current_tab","tabs","addTab","setType","addTabToArray","setActiveTab","remove_tab","updateTab","loadTabs","key","newTab","setItem","toLowerCase","tabId","delete_resource","filter","item","j","tab_id","slice","tab","updateLocalStorage","prevProps","prevSate","newResource","resourcesFromJson","num","newResourceModal","showResourcePane","map","addAtomFromText","cytoscape","use","cola","contextMenus","$","edgehandles","Cytoscape","newAtomRef","newSchemeRef","editContentRef","modalValue","dropDownValue","default_sadface_doc","created_date","edited_date","document_id","position","edit_atom","selected","redo_stack","undo_stack","running","initialise_monkeypuzzle","initCytoscape","setModalValue","handleModalValueChange","setDropDownValue","handledropDownValue","addScheme","editScheme","addAtom","editAtomContent","editAtomMetadata","deleteAtom","deleteNodes","merge_nodes","undo","redrawVisualisation","dragoverHandler","dropHandler","getItem","setCurrentSadFaceDoc","setCyData","current_sadface_doc","container","getElementById","elements","cyData","selector","boxSelectionEnabled","autounselectify","selectionType","minZoom","maxZoom","layout","build_cola_layout","run","toggleOffOnLeave","handleNodes","handleSize","handleColor","handleHitThreshold","handleLineWidth","edgeType","complete","sourceNode","targetNode","addedEles","source_position","target_position","x","y","scheme_content","remove","add","group","locked","edge1","edge2","cm","menuItems","onClickFunction","cyTarget","hasTrailingDivider","meta","coreAsWell","renderedPosition","cyPosition","redo","hideMenuItem","tooltipText","on","full","handleSetPng","handleSetJpg","opts","cola_params","animate","randomize","padding","fit","maxSimulationTime","opt","makeLayout","newModalValue","newDropDownValue","focused","width","height","scheme_name","update_scheme","editContent","new_text","update_atom_text","update_atom_metadata","alert","stop","options","eles","center","ev","preventDefault","dataTransfer","dropEffect","clientX","clientY","clearSelection","prevState","newAtomFromText","newAtomModal","newSchemeModal","editContentModal","editMetaDataModal","editSchemeTypeModal","onDrop","onDragOver","nextProps","App","json","uploadSADFACE","toggleMenu","loadJSON","setNewResource","setResourcesFromJson","setUndoStack","setRedoStack","returnSD","undo_item","edited","val","slideout","Slideout","operation","file","reader","FileReader","onload","result","readAsText","loadSADFace","json_value","importJSON","element","demo_sadface_doc","setUploadSADFACE","Boolean","hostname","match","render","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"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","file":"static/js/main.500a8acb.chunk.js","sourcesContent":["import React, { Component } from 'react';\nimport ReactDOM from 'react-dom';\nimport FocusTrap from 'focus-trap-react';\n// import focusTrap from 'focus-trap';\nexport class ModalContent extends Component {\n    constructor(props){\n    super(props);\n    this.state ={\n      buttons: 2,\n    }\n   \n\n\n  };\n  \n renderButtons(){\n  if(this.props.content.footer.buttonNo === 2){\n    return(\n    <div className=\"modal-footer\">\n      <button\n        ref={this.props.buttonRef}\n        aria-label=\"Close Modal\"\n        aria-labelledby=\"close-modal\"\n        onClick={this.props.closeModal}\n        type=\"button\"\n        className={this.props.content.footer.button1.className}\n      >\n          {this.props.content.footer.button1.value}\n      </button>\n      <button\n        type=\"button\"\n        className={this.props.content.footer.button2.className}\n        data-dismiss=\"modal\" \n        onClick={this.props.onClick}\n        >\n          {this.props.content.footer.button2.value}\n        </button>\n    </div>\n    );\n  }else{\n    return (\n      <div className=\"modal-footer\">\n<button\n        ref={this.props.buttonRef}\n        aria-label=\"Close Modal\"\n        aria-labelledby=\"close-modal\"\n        onClick={this.props.closeModal}\n        type=\"button\"\n        className={this.props.content.footer.button1.class}\n      >\n          {this.props.content.footer.button1.value}\n      </button>\n      </div>\n      );\n\n  }\n }\n\n \n\n\n\n  render(\n\n    \n    ) {\n    return ReactDOM.createPortal(\n      <FocusTrap>\n        <aside\n          tag=\"aside\"\n          role=\"dialog\"\n          tabIndex=\"-1\"\n          aria-modal=\"true\"\n          className=\"modal-cover\"\n          onClick={this.props.onClickOutside}\n          onKeyDown={this.props.onKeyDown}\n          id={this.props.id}\n        >\n        <div className=\"modal-dialog modal-lg\">\n          <div className=\"modal-content\" ref={this.props.modalRef}>\n           <div className=\"modal-header\">\n            <h4 className=\"modal-title\">{this.props.content.title}</h4>\n            <button\n              ref={this.props.buttonRef}\n              aria-label=\"Close Modal\"\n              aria-labelledby=\"close-modal\"\n              className=\"close\"\n              onClick={this.props.closeModal}\n              type=\"button\"\n            >\n              &times;\n            </button>\n           </div>\n          \n              {this.props.content.content}\n            \n            {this.renderButtons()}\n            \n            \n              \n          </div>\n          </div>\n        </aside>\n      </FocusTrap>,\n      document.body\n    );\n  }\n}\n\nexport default ModalContent;\n","import React, { Component } from 'react';\nclass ModalTrigger extends Component {\n  render() {\n    const {\n      style = {display: \"block\"},\n    } = this.props;\n    return (\n      <button\n        id={this.props.id}\n        ref={this.props.buttonRef}\n        onClick={this.props.showModal}\n        className={this.props.className}\n        style={{display: style}}\n        title={this.props.title}\n      >\n        {this.props.triggerText}\n      </button>\n    );\n  }\n}\n\nexport default ModalTrigger;\n","import React, { Component } from 'react';\nimport ModalContent from './ModalContent';\nimport ModalTrigger from './ModalTrigger';\n\nimport './Modal.css';\n\n\nexport class Modal extends Component {\n  constructor() {\n    super();\n    this.state = {\n      isShown: false\n    };\n  }\n  showModal = () => {\n    this.setState({ isShown: true }, () => {\n      this.closeButton.focus();\n    });\n    this.toggleScrollLock();\n  };\n  closeModal = () => {\n    this.setState({ isShown: false });\n    this.TriggerButton.focus();\n    this.toggleScrollLock();\n  };\n  onKeyDown = event => {\n    if (event.keyCode === 27) {\n      this.closeModal();\n    }\n  };\n  onClickOutside = event => {\n    if (this.modal && this.modal.contains(event.target)) return;\n    this.closeModal();\n  };\n\n  toggleScrollLock = () => {\n    document.querySelector('html').classList.toggle('scroll-lock');\n  };\n\n  actionAndClose = () => {\n    \n    this.props.onClick();\n    this.closeModal();\n  };\n  render() {\n    \n    return (\n      <React.Fragment>\n        <ModalTrigger\n          showModal={this.showModal}\n          buttonRef={n => (this.TriggerButton = n)}\n          triggerText={this.props.modalProps.trigger.triggerText}\n          className={this.props.modalProps.trigger.className}\n          id={this.props.modalProps.trigger.triggerId}\n          style={this.props.show}\n          title={this.props.modalProps.trigger.title}\n        />\n        {this.state.isShown ? (\n          <div>\n          <ModalContent\n            id={this.props.modalProps.id}\n            modalRef={n => (this.modal = n)}\n            buttonRef={n => (this.closeButton = n)}\n            closeModal={this.closeModal}\n            modalTitle={this.props.modalProps.modalTitle}\n            content={this.props.modalProps}\n            onKeyDown={this.onKeyDown}\n            onClickOutside={this.onClickOutside}\n            onClick={this.actionAndClose}\n          />\n          </div>\n        ) : (\n          <React.Fragment />\n        )}\n      </React.Fragment>\n    );\n  }\n}\n\nexport default Modal;\n","export var sd = {\n    resources: [],\n    nodes: [],\n    edges:[],\n};\n\n//values from defaults.cfg\nexport var a_name = \"A user\";\nexport var a_email = \"user@email.address\";\nexport var f_name = \"data\";\n\nexport function add_argument(con_text, prem_text, con_id, prem_id) {\n    /*\n    Syntactic sugar to create an argument structure from a set of texts.\n    Given a conclusion text & a list of premise texts, create an intermediate,\n    default \"support\" scheme.\n\n    This makes it easier to build a SADFace document without manually creating\n    and organising individual nodes.\n\n    Returns an argument dict, e.g.\n\n    {\n        \"conclusion\": atom,\n        \"scheme\": atom,\n        \"premises\": [atom(s)]\n    }\n\n    Returns: a dict\n    */\n    if(((con_text !== null && con_text !== undefined) || (con_id !== null && con_id !== undefined)) && ((prem_text !== null && prem_text !== undefined) || (prem_id !== null && prem_id !== undefined))) {\n        \n        var c;\n        var s;\n        var p_list = [];\n        var atom;\n        var arg = {};\n        \n        if(con_text !== null) {\n            c = add_atom(con_text);\n        } else {\n            c = get_atom(con_id);\n        }\n        s = add_scheme(\"support\");\n        try  {\n            add_edge(s.id, c.id);\n        }\n        catch(ex) {\n            console.log(ex);\n            throw (\"Could not create new argument\");\n        }\n        \n        \n        if(prem_text !== null) {\n            prem_text.forEach(function(text) {\n                atom = add_atom(text);\n                p_list.push(atom.id);\n                try {\n                    add_edge(atom.id, s.id);\n                }\n                catch (ex) {\n                    console.log(ex);\n                    throw (\"Could not create new argument\");\n                }\n            });\n        }\n        if(prem_id !== null) {\n            prem_id.forEach(function(atom_id) {\n                atom = get_atom(atom_id);\n                p_list.push(atom.id);\n                try {\n                    add_edge(atom.id, s.id);\n                }\n                catch (ex) {\n                    console.log(ex);\n                    throw (\"Could not create new argument\");\n                } \n            });\n        }\n        arg = {\"conclusion\":c, \"scheme\":s, \"premises\":p_list};\n        return arg;\n    }\n    return;\n}\n\nexport function add_conflict(arg_text, arg_id, conflict_text, conflict_id) {\n    /*\n        Conflicts play an important role in arguments. We depict conflict\n    through the use of schemes that represent the conflict relationship. This\n    function will instantiate a conflict scheme between two nodes (either\n    pre-existing & identifed by node IDs or created from supplied texts, or a\n    mixture of the two).\n\n    Returns a conflict dict, e.g.\n\n    {\n        \"argument\": atom,\n        \"scheme\": atom,\n        \"conflict\": atom\n    }\n    (where the scheme just happens to depict a conflict)\n\n    Returns: a dict\n    */\n    if(((arg_text !== null && arg_text !== undefined) || (arg_id !== null && arg_id !== undefined )) && ((conflict_text !== null && conflict_id !== null) || (conflict_text !== undefined && conflict_id !== undefined))) {\n        \n        var c;\n        var s;\n        var a;\n        var arg = {};\n        \n        if (arg_text!==null || arg_text !==undefined) {\n            a = add_atom(arg_text);\n        } else {\n            a = get_atom(arg_id);\n        }\n        s = add_scheme(\"conflict\");\n        \n        try {\n            add_edge(s.id, a.id);\n        }\n        catch(ex) {\n            console.log(ex);\n            throw (\"Could not create new argument\");\n        }\n        \n        if (conflict_text !== null || conflict_text !== undefined) {\n            c = add_atom(conflict_text);\n        } else {\n            c = get_atom(conflict_id);\n        }\n        \n        try {\n            add_edge(c.id, s.id);\n        }\n        catch(ex) {\n            console.log(ex);\n            throw(\"Could not create new argument\");\n        }\n        \n        arg = {\"argument\":a, \"scheme\":s, \"conflict\":c};\n        return arg;\n    }\n    return;\n}\n\nexport function add_edge(source_id, target_id) {\n    /*\n    Given a source atom ID & a target atom ID, create an \n    edge linking the two and add it to the sadface doc,\n    \"sd\" & return the dict representing the edge. If\n    either of source or target IDs is invalid then an\n    exception is raised.\n\n    Returns: a dict \n    */\n    if (source_id && target_id) {\n        if ((get_node(source_id) !== null) && (get_node(target_id) !== null)) {\n            var edge = new_edge(source_id, target_id);\n            sd.edges.push(edge);\n            return edge;\n        }\n        throw(\"Could not create new edge between: \" +source_id+\" & \"+target_id);\n    }\n}\n\nexport function add_atom(text) {\n    /*    \n    Create a new argument atom using the supplied text\n\n    Returns: the new atom dict\n    */\n    if (text) {\n        var atom = new_atom(text);\n        sd.nodes.push(atom);\n        return atom;\n    }\n}\n\nexport function add_atom_metadata(atom_id, key, value) {\n    /*\n    Add metadata, a key:value pair to the atom dict identified\n    by the supplied atom ID.\n    */\n    if (atom_id && key && value) {\n        sd.nodes.forEach(function(node) {\n            if(\"atom\" === node.type) {\n                if (atom_id === node.id) {\n                    node.metadata[key] = value;\n                }\n            }\n        });\n    }\n}\n\nexport function add_resource(content) {\n    /*\n    Create a new resource dict using the supplied content string\n    then add to the resourses list of the sadface doc\n\n    Returns: the new resource dict\n    */\n    if (content) {\n        var res = new_resource(content);\n\n        sd.resources.push(res);\n        return res;\n    }\n}\n\nexport function add_resource_metadata(resource_id, key, value) {\n    /*\n    Add metadata, a key:value pair to the resource dict identified\n    by the supplied atom ID.    \n    */\n    if (resource_id && key && value) {\n        sd.resources.forEach(function(res) {\n            if(res.id === resource_id) {\n                res.metadata[key] = value;\n            }\n        });\n\n    }\n}\n\n\nexport function add_sadface_metadata(key, value) {\n    /*\n    Add metadata, a key:value pair to the base sadface doc\n    */\n    if (key && value) {\n        sd.metadata[key] = value;\n    }\n}\n\n\nexport function add_scheme(name) {\n    /*\n    Add a new scheme node dict to the sadface document. The scheme type\n    is identified by the supplied name\n\n    Returns: The new scheme dict\n    */\n    if (name) {\n        var scheme = new_scheme(name);\n        sd.nodes.push(scheme);\n        return scheme;\n    }\n}\n\n\nexport function add_source(atom_id, resource_id, text, offset, length) {\n    /*\n    Add a new source dict to the atom identified by the supplied\n    atom ID. The new source refers to the an existing resource that\n    is identified by the supplied resource ID. The source identifies\n    text string in the resource dict that it references as well as\n    the offset & length of the text from the beginning of the resource\n\n    Returns: The new source dict\n    */\n    if (atom_id && resource_id && text !== null && offset !== null && length !== null && text !== undefined && offset !== undefined && length !== undefined) {\n        var source = new_source(resource_id, text, offset, length);\n        sd.nodes.forEach(function(node) {\n            if (\"atom\" === node.type) {\n                if (atom_id === node.id) {\n                    node.sources.push(source);\n                }\n            }\n        });\n        return source;\n    }\n}\n\n\nexport function delete_atom(atom_id) {\n    /*\n    Remove the atom from the sadface document identified by the\n    supplied atom ID\n    */\n    if (atom_id) {\n        var atom = get_atom(atom_id);\n        if (atom !== null && atom !== undefined) {\n            var size = Object.keys(sd.nodes).length;\n            for (var i = 0; i < size; ++i) {\n                if (sd.nodes[i].id === atom.id) {\n                    delete sd.nodes[i];\n                    sd.nodes = remove_falsy(sd.nodes);\n                    return;\n                }\n            }\n        }\n    }\n}\n\n\nexport function delete_edge(edge_id)\n{\n    /*\n    Remove the edge from the sadface document identified by the\n    supplied edge ID\n    */\n    if (edge_id) {\n        var del_edge = get_edge(edge_id);\n        var size = Object.keys(sd.edges).length;\n        for (var i = 0; i < size; ++i) {\n            if (sd.edges[i].id === del_edge.id) {\n                delete sd.edges[i];\n                sd.edges = remove_falsy(sd.edges);\n                return;\n            }\n        }\n    }\n}\n\n\nexport function delete_source(atom_id, resource_id) {\n    /*\n    Remove a source from the atom identified by the\n    supplied atom ID & resource ID respectively\n    */\n    if (atom_id && resource_id) {\n        var source = get_source(atom_id, resource_id);\n        var size = Object.keys(sd.nodes).length;\n        for (var i = 0; i < size; ++i) {\n            if (sd.nodes[i].atom.sources.resource_id === source.id) {\n                delete sd.nodes[i].atom_id.sources.resource_id;\n                sd.nodes[i].atom_id.sources = remove_falsy(sd.nodes);\n                return;\n            }\n        }\n    }\n}\n\n\nexport function delete_resource(resource_id) {\n    /*\n    Remove the resource from the sadface document identified by the\n    supplied resource ID\n    */\n    if (resource_id) {\n        var resource = get_resource(resource_id);\n        if (resource !== null && resource !== undefined) {\n            var size = Object.keys(sd.resources).length;\n            for (var i = 0; i < size; ++i) {\n                if (sd.resources[i].id === resource.id) {\n                    delete sd.resources[i];\n                    sd.resources = remove_falsy(sd.resources);\n                    return;\n                } \n            }\n        }\n    }\n}\n\n\nexport function delete_scheme(scheme_id) {\n    /*\n    Remove the schemee from the sadface document identified by the\n    supplied scheme ID\n    */\n    if (scheme_id) {\n        var scheme = get_scheme(scheme_id);\n        if (scheme !== null && scheme !== undefined) {\n            var size = Object.keys(sd.nodes).length;\n            for (var i = 0; i < size; ++i) {\n                if (sd.nodes[i].id === scheme.id) {\n                    delete sd.nodes[i];\n                    sd.nodes = remove_falsy(sd.nodes);\n                    return;\n                } \n            }\n        }\n    }\n}\n\n\nexport function export_cytoscape(sadface) {\n    /*\n    Cytoscape.js is a useful graph visualisation library for Javascript. However\n    it uses some slightly different keynames and includes description of visual\n    elements, useful to Cytoscape\"s visualisation, but having no place in SADFace.\n\n    Both nodes & edges in a Cytoscape graph are collated together into a single\n    elements object so we need to do that to the SADFace nodes & edges. Furthermore,\n    each node and edge object must contain a data object. After that conversion is\n    a relatively straightforward mapping:\n\n    EDGES\n        id -> id\n        source_id -> source\n        target_id -> target\n\n        e.g. \n        {\n            \"data\": {\n                \"source\": \"a1\",\n                \"id\": \"a1s1\",\n                \"target\": \"s1\"\n            }\n        }\n\n    NODES - ATOMS    \n        id -> id\n        type -> type\n        text -> content\n        + \"classes\":\"atom-label\"\n        + \"typeshape\":\"roundrectangle\"\n\n        e.g.\n        {\n            \"classes\": \"atom-label\",\n            \"data\": {\n                \"content\": \"Every person is going to die\",\n                \"type\": \"atom\",\n                \"id\": \"a1\",\n                \"typeshape\": \"roundrectangle\"\n            }\n        }\n\n\n    NODES - SCHEMES\n        id -> id\n        type -> type\n        name -> content\n        + \"classes\":\"scheme-label\"\n        + \"typeshape\":\"diamond\"\n        \n        e.g.\n        {\n            \"classes\": \"scheme-label\",\n            \"data\": {\n                \"content\": \"Default\\nSupport\",\n                \"type\": \"scheme\",\n                \"id\": \"s1\",\n                \"typeshape\": \"diamond\"\n            }\n        }\n\n    */\n    //allows export_cytoscape to take a value such as a loaded sadface file and return a cytoscape visualisation\n    if (sadface === null || sadface === undefined)\n    {\n            console.log(sadface, 'sadface null');\n\n        sadface = sd;\n    }\n    var cy = {};\n    cy.nodes = [];\n    cy.edges = [];\n    \n\n    sadface.edges.forEach(function(edge) {\n        var e = {};\n        e.data = {};\n        e.data.id = edge.id;\n        e.data.source = edge.source_id;\n        e.data.target = edge.target_id;\n        cy.edges.push(e);\n    });\n    sadface.nodes.forEach(function(node){\n    })\n    sadface.nodes.forEach(function(node) {\n        if(node !== null){\n        var n = {};\n        n.data = {};\n        n.data.id = node.id;\n        n.data.type = node.type;\n\n        if (n.data.type === \"atom\") {\n            n.classes = \"atom-label\";\n            n.data.typeshape = \"roundrectangle\";\n            n.data.content = node.text;\n        } else {\n            n.classes = \"scheme-label\";\n            n.data.typeshape = \"diamond\";\n            n.data.content = node.name;\n        }\n        \n        cy.nodes.push(n);\n    }\n    });\n    return JSON.stringify(cy);\n\n}\n\nexport function export_dot() {\n    /*\n    Exports a subset of SADFace to the DOT graph description language\n\n    Returns: String-encoded DOT document\n    */\n    var max_length = 25;\n    var edge_str = \" -> \";\n    var dot = \"digraph SADFace {\";\n    dot += \"node [style=\\\"filled\\\"]\";\n\n    sd.nodes.forEach(function(node) {\n        var line;\n        if (node.indexof(\"text\")) {\n            var txt = node.text;\n            if (txt.length > max_length) {\n                txt = \"\\r\\n\".join(textwrap(txt,max_length));\n            }\n            line = \"\\\"{}\\\"\".format(node.id) + \"[label=\\\"\" + txt + \"\\\"]\" + \" [shape=box, style=diamond];\\n\";\n            dot += line;\n        } else if (node.indexof(\"name\")) {\n            line = \"\\\"{}\\\"\".format(node.id) + \" [label=\\\"\" + node.name + \"\\\"]\" + \" [shape=diamond];\\n\";\n            dot += line;\n        }\n    });\n    \n    sd.edges.forEach(function(edge) {\n        var source = get_node(edge.source_id);\n        var target = get_node(edge.target_id);\n        \n        if(\"atom\" === source.type) {\n            dot += \"\\\"{}\\\"\".format(source.id);\n        } else if (\"scheme\" === source.type){\n            dot += \"\\\"{}\\\"\".format(source.id);\n        }\n        \n        dot += edge_str;\n        \n        if(\"atom\" === target.type) {\n            dot += \"\\\"{}\\\"\".format(target.id);\n        } else if (\"scheme\" === target.type){\n            dot += \"\\\"{}\\\"\".format(target.id);\n        }\n        \n        dot += \";\\n\";    \n    });\n    dot += \"}\";\n}\n\nexport function export_json() {\n    /*\n    Dump the current sadface document to a JSON string\n\n    Returns: String-encoded JSON\n    */\n    return JSON.stringify(sd);\n}\n\nexport function get_atom(atom_id) {\n    /*\n    Retrieve the atom dict identified by the supplied atom ID\n\n    Returns: An atom dict\n    */\n    console.log(atom_id);\n    if (atom_id) {\n        var node;\n        var size = Object.keys(sd.nodes).length;\n        for (var i = 0; i < size; ++i) {\n            node = sd.nodes[i];\n            if (node.id === atom_id) {\n                return node;\n            } \n        }\n    }\n}\n\nexport function get_atom_metadata(atom_id) {\n    /*\n    Retrieve the metadata associated with the supplied atom ID.\n    */\n    if (atom_id) {\n        var atom = get_atom(atom_id);\n        return atom.metadata;\n\n    }\n}\n\nexport function get_edge(edge_id) {\n    /*\n    Retrieve the edge dict identified by the supplied edge ID\n\n    Returns: An edge dict\n    */\n    if (edge_id) {\n        var edge;\n        var size = Object.keys(sd.edges).length;\n        for (var i = 0; i < size; ++i) {\n            edge = sd.edges[i];\n            if (edge.id === edge_id) {\n                return edge;\n            } \n        }\n    }\n}\n\nexport function get_node(node_id) {\n    /*\n    Given a node\"s ID but no indication of node type, return the node if \n    it exists or else indicate that it doesn\"t to the caller.\n\n    Returns: A node dict or None\n    */\n    if (node_id) {\n        var node;\n        var size = Object.keys(sd.nodes).length;\n        for (var i = 0; i < size; ++i) {\n            node = sd.nodes[i];\n            if (node.id === node_id) {\n                return node;\n            } \n        }\n    }\n}\n\nexport function get_resource(resource_id) {\n    /*\n    Retrieve the resource dict identified by the supplied resource ID\n\n    Returns: An resource dict\n    */\n    if (resource_id) {\n        var resource;\n        var size = Object.keys(sd.resources).length;\n        for (var i = 0; i < size; ++i) {\n            resource = sd.resources[i];\n            if (resource.id === resource_id) {\n                return resource;\n            } \n        }\n    }\n}\n\nexport function get_scheme(scheme_id) {\n    /*\n    Retrieve the scheme dict identified by the supplied scheme ID\n\n    Returns: A scheme dict\n    */\n    if (scheme_id) {\n        var node;\n        var size = Object.keys(sd.nodes).length;\n        for (var i = 0; i < size; ++i) {\n            node = sd.nodes[i];\n            if (node.id === scheme_id) {\n                return node;\n            } \n        }\n    }\n}\n\n//get source returns an array of two values since Javascript doesn\"t support multiple return values\nexport function get_source(atom_id, resource_id) {\n    /*\n    Retrieve the source dict identified by the supplied source ID\n\n    Returns: An source dict\n    */\n    if (atom_id && resource_id) {\n        var sourced = [];\n        var atom = get_atom(atom_id);\n        var source;\n        var size = Object.keys(atom.sources).length;\n        for (var i = 0; i < size; ++i) {\n            source = atom.sources[i];\n            if (source.resource_id === resource_id) {\n                sourced[0] = atom;\n                sourced[1] = source;\n                return sourced;\n            } \n        }\n    }\n}\n\nexport function import_json(json_string) {\n    /*\n    Take a string-encoded JSON document and loads it into a dict\n\n    Returns: the loaded dict\n    */\n    if (json_string) {\n        sd = JSON.parse(json_string);\n        return sd;\n    }\n}\n\n// the try/catch in sadface.py is not needed as javascript cannot read local files without making an http request (which means app can\"t be run without server), cfg values have been hardcoded\nexport function init() {\n    /*\n    Reads the config file from the supplied location then uses the data\n    contained therein to personalise a new SADFace document\n\n    Returns: A dict representing the new SADFace document\n    */\n    return new_sadface();\n}\n\nexport function new_atom(text) {\n    /*\n    Creates a new SADFace atom node (dict) using the supplied text\n\n    Returns: A dict representing the new SADFace atom\n    */\n    if (text) {\n        var new_atom = {\"id\":new_uuid(), \"type\":\"atom\", \"text\":text, \"sources\":[], \"metadata\":{}};\n        return new_atom;\n    }\n}\n\nexport function new_edge(source_id, target_id) {\n    /*\n    Creates & returns a new edge dict using the supplied source & \n    target IDs\n\n    Returns: A dict representing the new edge\n    */\n    if (source_id && target_id) {\n        var new_edge = {\"id\":new_uuid(), \"source_id\":source_id, \"target_id\":target_id};\n        return new_edge;\n    }\n}\n\nexport function new_sadface() {\n    /*\n    Creates & returns a new SADFace document\n\n    Returns: A dict representing the new SADFace document\n    */\n    var new_doc = {\"id\":new_uuid(), \"analyst_name\":a_name, \"analyst_email\":a_email, \"created\":now(), \"edited\":now(), \"metadata\":{}, \"resources\":[], \"nodes\":[], \"edges\":[]};\n    return new_doc;\n}\n\nexport function new_resource(content) {\n    /*\n    Given the supplied content (String), create a new resource dict\n\n    The arguments that SADFace describes are either constructed directly in a tool that writes\n    them to this format, or else are sourced from elsewhere, e.g. an argumentative text or\n    webpage, or else perhaps another medium, such as audio or video. Currently SADFace supports\n    textual resources which are stored in the content key. Optionally a \n        \"url\":\"some web location\"\n    pair can be added to the metadata to indicate a specific web location. Alternatively:\n        \"doi\":\"digital object identifier\" - resolvable by dx.doi.org\n        \"magnet-link\":\"a torrent file\"\n        \"isbn\":\"for books\"\n    Metadata may also store additional bibliographic or referencing/citation information\n    as defined in bibtex formats.\n\n    Returns: A dict representing the new SADFace resource\n    */\n    if (content) {\n        var new_resource = {\"id\":new_uuid(), \"content\":content, \"type\":\"text\", \"metadata\":{}};\n        return new_resource;\n    }\n}\n\nexport function new_scheme(name) {\n    /*\n    Create a new SADFace scheme (Python dict) using the supplied scheme name. The scheme\n    name should refer to an existing scheme from a known schemeset\n\n    Returns: A Python dict representing the new SADFace scheme\n    */\n    if (name) {\n        var new_scheme = {\"id\":new_uuid(), \"type\":\"scheme\", \"name\":name};\n        return new_scheme;\n    }\n}\n\nexport function new_source(resource_id, text, offset, length) {\n    /*\n    Create a new SADFace source (Python dict) using the supplied resource ID (a source always\n    refers to an existing resource object) and identifying a section of text in the resource \n    as well as an offset & segment length for locating the text in the original resource.\n\n    As the resource object is enhanced to account for newer \"types\" of resource, so the\n    source object must be enhanced to keep track and enable sources to index sub-parts of\n    resources.\n\n    Returns: A Python dict representing the new SADFace source\n    */\n    if (resource_id && text !== null && text !== undefined && offset !== null && offset !== undefined && length !== null && length !== undefined) {\n        var new_source = {\"resource_id\":resource_id, \"text\":text, \"offset\":offset, \"length\":length};\n        return new_source;\n    }\n}\n\n//uuid function from https://stackoverflow.com/questions/105034/create-guid-uuid-in-javascript\nexport function new_uuid() {\n    /*\n    Utility method to generate a new universally unique ID. Used througout to uniquely\n    identify various items such as atoms, schemes, resources, & edges\n\n    Returns: A string\n    */\n    return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>\n        (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)\n    );\n}\n\nexport function now() {\n    /*\n    Utility method to produce timestamps in ISO format without the microsecond\n    portion, e.g. 2017-07-05T17:21:11\n\n    Returns: A String\n    */\n    var d = new Date();\n    //removes microseconds and Z from the ISO string\n    return d.toISOString().split(\".\")[0];\n}\n\nexport function prettyprint(doc) {\n    /*\n    Print nicely formatted output of the passed in string or\n    otherwise the SADFace document encoded as a String\n\n    Returns: A String\n    */\n    var string;\n    if (doc !== null || doc !== undefined) {\n        string = sd;\n    } else {\n        string = doc;\n    }\n    return JSON.stringify(string, null, 2);\n}\n\nexport function saveSADFace(filename, filetype) {\n    /*\n    Write the prettyprinted SADFace document to a JSON file and download\n    */\n    var f = filename;\n    var text;\n    if (f === null || f === undefined) {\n        f = f_name;\n    }\n    \n    if (\"dot\" === filetype) {\n        f += \".dot\";\n        text = export_dot();\n    } else if (\"cytoscape\" === filetype) {\n        f += \".json\";\n        text = prettyprint(JSON.parse(export_cytoscape(null)));\n    } else {\n        f += \".json\";\n        text = JSON.stringify(sd, null, 2);\n    }\n    download(f, text);\n}\n\nexport function loadSADFace(file) {\n    /*\n    Create a read for a JSON file\n    */\n    if (file) {\n        var reader = new FileReader();    \n        reader.readAsText(file);\n        \n        return reader;\n    }\n}\n\nexport function download(filename, text) {\n    /*\n    Downloads a file given its filename and its text using utf-8 charset\n    */\n    console.log(\"Downloading \"+filename);\n    var outfile = document.createElement(\"a\");\n    outfile.setAttribute(\"href\", \"data:text/plain;charset=utf-8,\" + encodeURIComponent(text));\n    outfile.setAttribute(\"download\", filename);\n\n    outfile.style.display = \"none\";\n    document.body.appendChild(outfile);\n\n    outfile.click();\n\n    document.body.removeChild(outfile);\n}\n\nexport function update() {\n    /*\n    Updates the last edited timestamp for the SADFace doc to now\n    */\n    sd.edited = now();\n}\n\nexport function update_analyst_email(analystemail) {\n    /*\n    Updates the name of the argument analyst in the SADFace doc to the supplied name\n    */\n    if (analystemail) {\n        sd.analyst_email = analystemail;\n    }\n}\n\nexport function update_analyst_name(analystname) {\n    /*\n    Updates the name of the argument analyst in the SADFace doc to the supplied name\n    */\n    if (analystname) {\n        sd.analyst_name = analystname;\n    }\n}\n\nexport function update_atom_text(atom_id, new_text) {\n    /* \n    An atoms text key:value pair is the canonical representation of a portion of text \n    that exists in an argument. This should be updatable so that the overall document \n    makes sense. Links to original source texts are maintained via the source list \n    which indexes original text portions of linked resources.\n\n    Returns: The updated atom dict\n    */\n    if (atom_id && new_text) {\n        var atom = get_atom(atom_id);\n        if (atom !== null || atom !== undefined) {\n            atom.text = new_text;\n            return atom;\n        } else {\n            throw (\"Could not update the text value for atom: \"+atom_id);\n        }\n    }\n}\n\nexport function update_atom_metadata(atom_id, metadata) {\n    /*\n    Given an atoms ID and a dict object containing its metadata, updates the atom with\n    new set of metadata.\n    \n    Returns: The updated atom dict\n    */\n    if (atom_id && metadata) {\n        var atom = get_atom(atom_id);\n        if (atom !== null || atom !== undefined) {\n            atom.metadata = metadata;\n            return atom;\n        } else {\n            throw (\"Could not update the metadata for atom: \"+atom_id);\n        }\n    }\n}\n\nfunction update_created(timestamp) {\n    /*\n        Updates the creation timestamp for the SADFace document to the supplied timestamp.\n    This can be useful when moving analysed argument data between formats whilst\n    maintaining original metadata.\n    */\n    if (timestamp) {\n        sd.timestamp = timestamp;\n    }\n}\n\nfunction update_id(id) {\n    /*\n    Update the SADFace document ID to match the supplied ID. This can be useful when \n    moving analysed argument data between formats whilst maintaining original metadata.\n    */\n    if (id) {\n        sd.id = id;\n    }\n}\n\nexport function update_edited(timestamp) {\n    /*\n    Update the last edited timestamp for the SADFace doc to match the supplied\n    timestamp. This can be useful when moving analysed argument data between formats \n    whilst maintaining original metadata.\n    */\n    if (timestamp) {\n        sd.edited = timestamp;\n    }\n}\n\nexport function update_scheme(scheme_id, scheme_name) {\n    /*\n    Given an ID for an existing scheme node, update the name associated with it and return the scheme node.\n    \n    Returns: Updated scheme dict\n    */\n    if (scheme_id && scheme_name) {\n        var scheme = get_scheme(scheme_id);\n        if (scheme !== null || scheme !== undefined) {\n            scheme.name = scheme_name;\n            return scheme;\n        } else {\n            throw (\"Could not update the name of scheme: \"+scheme_id);\n        }\n    }\n}\n\nexport function update_resource(resource_id, content, title) {\n    /*\n    Given an ID for an existing resource, update the content and metadata of the resource.\n    Updates the resource in sd;\n    */\n\n    if (resource_id && (content || title)) {\n        var resource = get_resource(resource_id);\n        if (resource !== null && resource !== undefined) {\n            if (content !== null && content !== undefined) {\n                resource.content = content;\n            }\n            if (title !== null && title !== undefined) {\n                resource.metadata.title = title;\n            }\n            sd.resources.forEach((res) => {\n                if(res.id === resource_id) {\n                    res = resource;\n                }\n            });\n        } else {\n            throw (\"Could not update the resource: \"+resource_id);\n        }\n    }\n}\n\nexport function get_sd() {\n    /*\n    Function to get the current state of SD\n    \n    Returns: Current state of SD\n    */\n    return sd;\n}\n\n\n/*\n*\n*   JS Specific Utility Functions\n*\n*/\n\n/*\nString.prototype.format = () => {\n  var i = 0, args = arguments;\n  return this.replace(/{}/g, () => {\n    return typeof args[i] !== \"undefined\" ? args[i++] : \"\";\n  });\n};\n\n*/\nexport const remove_falsy = (obj) => {\n    /*\n    The delete function in javascript tends to replace deleted objects with\n    null values. This function removes those from an object after something within it is deleted.\n    */\n    if (obj) {\n        var newObj = [];\n        Object.keys(obj).forEach((prop) => {\n            if (obj[prop]) { \n                newObj.push(obj[prop]); \n            }\n        });\n        return newObj;\n    } else {\n        return obj;\n    }\n};\n\n\n//textwrap function from https://gist.github.com/bgrayburn/44fa018b94222590f618\nfunction textwrap (long_string, max_char){\n    if (long_string && max_char) {\n        var sum_length_of_words = (word_array) => {\n            var out = 0;\n            if (word_array.length!==0){\n              for (var i=0; i<word_array.length; i++){\n                var word = word_array[i];\n                out = out + word.length;\n              }\n            }\n            return out;\n        };\n\n        var split_out = [[]];\n        var split_string = long_string.split(\" \");\n        for (var i=0; i<split_string.length; i++){\n            var word = split_string[i];\n            \n            if ((sum_length_of_words(split_out[split_out.length-1]) + word.length) > max_char){\n              split_out = split_out.concat([[]]);\n            }\n            \n            split_out[split_out.length-1] = split_out[split_out.length-1].concat(word);\n        }\n      \n        for (i=0; i<split_out.length; i++){\n            split_out[i] = split_out[i].join(\" \");\n        }\n        return split_out;\n    }\n}\n\nexport function remove_resources_from_nodes(current_tab){\n    sd.nodes.forEach((node) => {\n        if (node.type == 'atom') {\n            if (current_tab in node.sources) {\n                delete_source(node.id, current_tab);\n            }\n        }\n    });\n\n}\n","import React, {Component} from 'react';\nimport Button from 'react-bootstrap/Button';\nimport Modal from '../Modal/Modal';\n\n//import functions from sadface\nimport {update_analyst_name, update_analyst_email} from '../../lib/Sadface'; \n\nimport './Menu.css';\nclass Menu extends Component {\n  constructor(props){\n    super(props);\n    this.state = {\n      \n    };\n    //refs\n    this.pngRef = React.createRef();\n    this.jpgRef = React.createRef();\n    this.loadJSONRef = React.createRef();\n\n\n    this.mp_reset = this.mp_reset.bind(this);\n    this.download_png = this.download_png.bind(this);\n    this.download_jpg = this.download_jpg.bind(this);\n    this.download_sadface = this.download_sadface.bind(this);\n    this.handleFileName = this.handleFileName.bind(this);\n    this.handleSADfaceUpload = this.handleSADfaceUpload.bind(this);\n    this.SADfaceUpload = this.SADfaceUpload.bind(this);\n  }\n\n   \n\n  mp_reset(){\n    console.log(\"reset\");\n    localStorage.clear();\n    window.location.reload(false);\n  }\n  \n\n\n  handle_set_analyst_name(event){\n    let analyst_name = event.target.value;\n\n      update_analyst_name(analyst_name)\n  }\n\n  handle_set_analyst_email(event){\n    let analyst_email = event.target.value;\n\n    update_analyst_email(analyst_email);\n  }\n\n\n \n\n  download_png(){\n    var fileName = this.props.fileName;\n    if(fileName.length === 0) {fileName = \"default\"}\n      fileName+=\".png\";\n      let link = this.pngRef.current;\n      link.download = fileName;\n  }\n\n  download_jpg(){\n      let fileName = this.props.fileName;\n      if(fileName.length === 0) {fileName = \"default\"}\n        fileName+=\".jpg\"\n\n      let link = this.jpgRef.current;\n      link.download = fileName;\n\n  }\n\n \n\n  download_sadface(){\n    this.props.fileManager('save', 'json', null)\n  }\n\n   handleFileName(event){\n    let file_name = event.target.value;\n    this.props.setFileName(file_name);\n  }\n\n  handleSADfaceUpload(){\n    let loadJSON = this.loadJSONRef.current;\n    loadJSON.click();\n  }\n\n  SADfaceUpload(){\n    let newFile = this.loadJSONRef.current.files;\n    this.props.fileManager('load','json',null,newFile);\n\n  }\n\n  render() {\n    /*Reset Confirmation Modal */\n\n      let resetConfirmModal = {\n        trigger: {\n          triggerText: 'Reset',\n          title: 'Reset MonkeyPuzzle to her initial state',\n          id: 'clear_storage_button',\n          className: 'btn btn-danger',\n        },\n        title: 'Reset MonkeyPuzzle',\n        id: \"confirm_reset_modal\",\n        content: <div className=\"modal-body\">\n        <p>Are you sure that you want to reset MonkeyPuzzle?<br /> This will empty the current analysis and adjust all options back to their initial settings.</p>\n        </div>,\n        footer: {\n          buttonNo: 2,\n          button1: {\n            className: 'btn btn-secondary',\n            value: 'Cancel',\n          },\n          button2: {\n            className: 'btn btn-danger',\n            value: 'Reset',\n          },\n        } \n      };\n    return (\n            /*Slidein Panel: START*/\n\n      <nav id=\"menu\" className=\"menu\">\n    <a href=\"http://arg.napier.ac.uk/monkeypuzzle/\" target=\"_blank\" rel=\"noopener noreferrer\">\n        <header className=\"menu-header\">\n          <span className=\"menu-header-title\">MonkeyPuzzle</span>\n        </header>\n    </a>\n\n    <section className=\"menu-section\">\n        <h3 className=\"menu-section-title\">Interface</h3>\n        <ul className=\"menu-section-list\">\n          <li>\n            <Button\n              id=\"toggle_resources\"\n              className=\"btn btn-default\" \n              variant=\"light\"\n              title=\"Toggle the visibility of the resources pane\"\n              children=\"Toggle Resource Pane\"\n              onClick={this.props.toggleResourcePane}\n\n            />\n          </li>\n          <li> \n            <Modal \n              modalProps = {resetConfirmModal}  \n              onClick = {this.mp_reset}\n\n            />\n          </li>\n          <li>\n           <Button\n            id=\"load_demo_argument_button\"\n            className=\"btn btn-default\" \n            variant=\"light\"\n            title=\"Load a demonstration SADFace document into MonkeyPuzzle\"\n            children=\"Load Demo\"\n            onClick={this.props.load_demo_argument}\n\n          />\n          </li>\n          <li>\n              <textarea \n                id=\"analyst_name_textarea\" \n                type=\"text\" rows=\"1\" \n                cols=\"20\" \n                maxLength=\"40\" style={{resize: \"none\"}} \n                className=\"form-control\"  \n                placeholder=\"Name\" \n                title=\"Type your name here...\" \n                onChange={this.handle_set_analyst_name}\n              >\n              </textarea>\n          </li>\n          <li>\n              <textarea \n                id=\"analyst_email_textarea\" \n                type=\"text\" \n                rows=\"1\" \n                cols=\"20\" \n                maxLength=\"40\" \n                style={{resize: \"none\"}} \n                className=\"form-control\"  \n                placeholder=\"Email\" \n                title=\"Type your email address here...\" \n                onChange={this.handle_set_analyst_email}\n              >\n              </textarea>\n          </li>\n      </ul>\n    </section>\n\n\n    <section className=\"menu-section\">\n        <h3 className=\"menu-section-title\">Export</h3>\n        <ul className=\"menu-section-list\">\n           <li>\n              <textarea \n                id=\"export_filename\" \n                type=\"text\" \n                rows=\"1\" \n                cols=\"20\" \n                maxLength=\"20\" \n                style={{resize: \"none\"}} \n                className=\"form-control\"  \n                placeholder=\"Filename\" \n                title=\"The name for the exported file\"\n                onChange={this.handleFileName}\n              >\n              </textarea>\n          </li>\n\n          <li>\n            <Button \n              id=\"export_button\"\n              className=\"btn btn-default\" \n              onClick={this.download_sadface} \n              title=\"Export the current analysis to a SADFace formatted JSON document\"\n              variant=\"light\"\n            >\n              SADFace\n            </Button>\n          </li>\n          <li>\n          <a href={this.props.png} \n          target=\"blank\" \n          id=\"download_png\"\n          ref={this.pngRef}\n          >\n            <Button \n             // id=\"download_png\"\n              className=\"btn btn-default\" \n              title=\"Export the current analysis to a PNG image\" \n              onClick={this.download_png}\n              variant=\"light\"\n            >\n              PNG\n            </Button>\n            </a>\n          </li>\n          <li>\n             <a href={this.props.jpg} \n             target=\"blank\" \n             id=\"download_jpg\"\n             ref={this.jpgRef}\n             >\n            <Button \n              id=\"download_jpg\"\n              className=\"btn btn-default\" \n              title=\"Export the current analysis to a JPG image\" \n              onClick={this.download_jpg}\n              variant=\"light\"\n            >\n              JPG\n            </Button>\n            </a>\n          </li>\n      </ul>\n      </section>\n      \n    <section className=\"menu-section\">\n        <h3 className=\"menu-section-title\">Import</h3>\n        <ul className=\"menu-section-list\">\n      <span className=\"upload-span\">\n        <a rel=\"ignore\">\n          <div style={{display: \"inline-block\"}}>\n           <input \n            id=\"loadJSON\" \n            style={{display: \"none\"}} \n            accept=\".json\" \n            role=\"button\" \n            tabIndex=\"-1000\" \n            type=\"file\" \n            className=\"upload-button\" \n            onChange={this.SADfaceUpload}\n            ref={this.loadJSONRef}\n          />\n          \n          <Button\n            className=\"btn btn-default\"\n            onClick={this.handleSADfaceUpload}\n            title=\"Load a SADFace formatted JSON document into MonkeyPuzzle\"\n            variant=\"light\"\n\n          >\n            SADFace\n          </Button>\n          </div>\n        </a>\n      </span>\n      \n        </ul>\n    </section>\n  \n    <section className=\"menu-section\">\n        <h3 className=\"menu-section-title\">Documentation</h3>\n        <ul className=\"menu-section-list\">  \n          <li>          \n            <a \n              href=\"http://arg.napier.ac.uk/page/project/monkeypuzzle/\" \n              id=\"a\"\n              >\n                About MonkeyPuzzle\n            </a>\n          </li>\n          <li>\n            <a \n              href=\"http://arg.napier.ac.uk/page/project/monkeypuzzle/quickstart/\" \n              id=\"a\"\n              >\n                Quick-start\n            </a>\n          </li>\n          <li>\n            <a \n              href=\"https://github.com/ARG-ENU/monkeypuzzle_web\" \n              id=\"a\"\n              >\n                Code Repository\n            </a>\n          </li>\n          <li>\n            <a \n              href=\"https://github.com/ARG-ENU/monkeypuzzle_web/issues\" \n              id=\"a\"\n            >\n              Issue Tracker\n            </a>\n          </li>\n          <li>\n            <a \n              href=\"https://github.com/ARG-ENU/monkeypuzzle_web/blob/master/LICENSE\" \n              id=\"a\"\n            >\n              Licensing\n            </a>\n          </li>\n      </ul>\n      </section>\n    </nav>\n    );\n  }\n}  // Slidein Panel: END \n\nexport default Menu;\n","import React, {Component} from 'react';\nimport { FaBars} from 'react-icons/fa';\n\n\n\nclass MenuTrigger extends Component {\n  render(){\n  \tconst {\n  \t\tonClick,\n  \t\tclassName,\n  \t} = this.props;\n  \t\n\t    return (\n\t    \t<button \n                \tclassName={className}\n                \tonClick={onClick}\n                \ttype=\"button\"\n\t\t\t\t>\n        <FaBars style={{color: \"#cbc5c1\"}}/>\n                </button>\n\t\t);\n\t}\n}\nexport default MenuTrigger;\n","import React, {Component} from 'react';\nimport Button from 'react-bootstrap/Button';\nimport { FaLockOpen, FaLock, FaPuzzlePiece, FaDownload, FaUpload, FaTrashAlt} from 'react-icons/fa';\n\n\n\nimport './ResourceBody.css';\n\n\n\nclass TabBody extends Component {\n    constructor(props){\n        super(props);\n    \n\n        this.state = {\n            readOnly: true,\n        };\n        //create ref\n\n        this.toggle_edit_lock = this.toggle_edit_lock.bind(this);\n        this.handleGetSelectedText = this.handleGetSelectedText.bind(this);\n        this.handleFocus = this.handleFocus.bind(this);\n\n    }\n\n    toggle_edit_lock(){\n        this.setState({readOnly: !this.state.readOnly},() =>\n        console.log('content area locked'));\n    }\n\n\n    handleGetSelectedText(){\n        if(window.getSelection().toString().length >= 1){\n            let select = window.getSelection().toString();\n            this.props.setSelectedText(select); \n    }else{\n        console.log(\"noSelect\");\n        this.props.setSelectedText('') \n    }\n\n    //       this.props.setSelectedText(window.getSelection().toString()); \n   // }else{\n        //window.getSelection().empty();\n    //        this.props.setSelectedText('')    }\n}\nhandleFocus(e){\n    this.props.setFocus(e.target.id);\n}\n\n    render() { \n        const {\n            \n            id,\n            handleremove,\n            handleFileDownload,\n            style,\n            clickLoad,\n            contentValue,\n            titleValue,\n            //element references\n            loadTxtRef,\n            titleRef,\n\n            handleFileUpload,\n            handleChange_title,\n            handleChangeContent,\n            handleAddAtomFromText,\n\n        }=this.props\n\n\n\n        return (\n            <div id={id+\"_body\"} className=\"resource_pane_tab_content\" style={style}>\n                <form>\n                    <div className=\"form-group\">\n                        <Button \n                            type=\"button\" \n                            className=\"btn btn-default\" \n                            title=\"Remove this tab from the resource pane\"\n                            onClick={handleremove}\n                            variant=\"light\"\n                            >\n                                <FaTrashAlt  />\n                            </Button>\n                            <input \n                                type=\"file\" \n                                id={\"load\" + id} \n                                style={{display: \"none\"}} \n                                accept=\".txt\" \n                                ref={loadTxtRef}\n                                onChange= {handleFileUpload}\n                            />\n                            <Button \n                                type=\"button\" \n                                id={\"load\" + id + \"_btn\"} \n                                className=\"btn btn-default\" \n                                onClick={clickLoad}\n\n                                title=\"Load a text file into this resource tab\"\n                                variant=\"light\"\n                            >\n                                <FaUpload />\n                            </Button>\n                            <Button \n                                type=\"button\" \n                                className=\"btn btn-default\" \n                                onClick={handleFileDownload}\n                                title=\"Save this resource tab to a text file\"\n                                variant=\"light\"\n                            >\n                                <FaDownload />\n                            </Button>\n                            <Button id={\"toggle_edit_lock_button \" + id}\n                                type=\"button\" \n                                className=\"btn btn-default\" \n                                title=\"Toggle editability of the content area\" \n                                onClick={ this.toggle_edit_lock}\n                                variant=\"light\"\n                            >\n                                {(this.state.readOnly) ? <FaLock /> : <FaLockOpen />}\n                                \n                            </Button>\n                            <Button \n                                type=\"button\" \n                                className=\"btn btn-default\" \n                                title=\"Add node from text selection\"\n                                onClick={handleAddAtomFromText}\n                                variant=\"light\"\n                                disabled={(this.props.selectedText.length >= 1) ? false: true}\n                            >\n                            <FaPuzzlePiece />\n                            </Button>\n                    </div>\n\n                    <div className=\"form-group\">\n                            <label>Title</label>\n                            <textarea \n                                id={\"title_\"+id} \n                                type=\"text\" \n                                rows=\"1\" \n                                style={{resize: \"none\"}} \n                                className=\"form-control\" \n                                placeholder=\"The name of this resource...\" \n                                onChange={handleChange_title}\n                                ref={titleRef}\n                                value={titleValue}\n                                >\n                            </textarea> \n                        <label>Content</label>\n                        <div id=\"textarea\">\n                            <textarea \n                                id={id} \n                                className=\"form-control\" \n                                placeholder=\"Enter your source text here...\" \n                                rows=\"20\" \n                                ref={this.setTextInputRef}\n                                onChange={handleChangeContent} \n                                style={{resize: \"vertical\", minHeight: \"35px\"}} \n                                readOnly={this.state.readOnly}\n                                value= {contentValue}\n                                onMouseUp = {this.handleGetSelectedText}\n                                onFocus={this.handleFocus}\n                                >\n                            </textarea>\n                        </div>  \n                    </div> \n                </form>\n            </div>\n        );\n    }\n}   \n\nexport default TabBody;","import React, {Component} from 'react';\n//Import Components\nimport Modal from '../../Modal/Modal';\nimport TabBody from '../ResourceBody/ResourceBody';\nimport{update_resource,remove_resources_from_nodes,delete_resource, add_resource, add_resource_metadata, get_sd} from '../../../lib/Sadface'; \nimport {FaPlusSquare} from 'react-icons/fa';\n\nimport './ResourceHead.css';\n\nclass ResourcePane extends Component {\n    constructor(props) {\n        super(props);\n        this.state={\n            resourceType: 'text',\n            current_tab: null,\n            tabs: [],\n        }\n        \n        this.addTab = this.addTab.bind(this);\n        this.setType = this.setType.bind(this);\n        this.addTabToArray = this.addTabToArray.bind(this);\n        this.setActiveTab = this.setActiveTab.bind(this);\n        this.remove_tab = this.remove_tab.bind(this);\n        this.updateTab = this.updateTab.bind(this);\n        this.loadTabs =this.loadTabs.bind(this);\n    };\n\n    addTab(){\n        let newTab = {}\n        \n        newTab = add_resource(' ');\n        add_resource_metadata(newTab.id, 'title', '');\n        newTab.metadata = {title: ''}\n        localStorage.setItem(\"state\", JSON.stringify(get_sd()));\n        newTab.type = this.state.resourceType;\n        this.addTabToArray(newTab);   \n    \n    }\n\n      setType(e){\n        this.setState({resourceType: e.target.value.toLowerCase()}, () =>\n            console.log(this.state.resourceType, 'type set'));\n    }\n\n     addTabToArray(newTab){\n        this.setState({\n            tabs: [...this.state.tabs, newTab]\n        }, () => console.log(this.state.tabs, \"add to arry\"));\n        this.setActiveTab(newTab.id);\n        \n    }\n\n     setActiveTab(value){\n        console.log(\"setActiveTabs\");\n        this.setState({\n            current_tab: value\n        }, function (){\n            console.log(this.state.current_tab, 'active');\n        });\n    }\n\n      remove_tab(i, tabId){\n        delete_resource(tabId);\n        remove_resources_from_nodes(tabId);\n\n        localStorage.setItem(\"state\",JSON.stringify(get_sd()));\n        \n        if (this.state.tabs.length >= 1 && i !== -1){\n            this.setState(state =>{\n                const tabs = state.tabs.filter((item, j) => i !==j);\n                return {\n                    tabs,\n                };\n            }, () => {    \n            if(this.state.tabs.length >=1){\n                this.setActiveTab(this.state.tabs[this.state.tabs.length-1].id);\n            }\n            });      \n        }   \n    };\n\n        updateTab(tab_id, title, content){\n            const tabs = this.state.tabs.slice();\n            tabs.forEach((tab) =>{\n                if(tab.id === tab_id) {\n                    if(title !== null){\n                        tab.metadata.title = title;\n                        update_resource(tab_id, null, title);\n                    }\n                    if(content !== null){\n                    tab.content = content;\n                    update_resource(tab_id, content, null);\n                }\n                }\n            });\n            this.setState({tabs}, () =>\n                console.log( \"Tabs updated\"));\n                this.props.updateLocalStorage();\n        }\n\n        loadTabs(resources){\n            if(resources.length > 0){\n            console.log(\"loadTabs\", resources);\n            this.setState({tabs: resources}, () => {\n                console.log(this.state.tabs, \"TABS\");\n                this.setActiveTab(this.state.tabs[this.state.tabs.length - 1].id);\n               \n            }\n            \n\n                );\n        }\n\n         }\n\n    componentDidUpdate(prevProps, prevSate) {\n        if(prevProps.newResource !== this.props.newResource){\n                this.updateTab(this.props.newResource.tab, null, this.props.newResource.content);\n                this.updateTab(this.props.newResource.tab, this.props.newResource.filename, null);\n        }\n        if(prevProps.resourcesFromJson !== this.props.resourcesFromJson){\n                this.loadTabs(this.props.resourcesFromJson);\n            \n            \n\n        }\n    }\n\n    render() {\n        let num =0;\n        const newResourceModal = {\n            trigger: {\n                triggerText: <FaPlusSquare size={32}  color=\"#cbc5c1\"/>,\n                className: 'add_tab_button',\n                triggerId: \"add_tab_button\",\n            },\n            id:\"resource_pane_selection_modal\",\n            title: 'New Resource Pane',\n            content:  <div className=\"modal-body\">\n                <p>Select a resource type</p>\n                <select className=\"form-control\" id=\"resource_type\" onChange={this.setType}>\n                <option>Text</option>\n                </select>\n                </div>,\n            footer: {\n                buttonNo: 2,\n                button1: {\n                    className: \"btn btn-secondary\",\n                    value: \"Close\"\n                },\n                button2: {\n                    className: \"btn btn-primary\",\n                    value: \"Add\"\n                }\n            }\n        };\n\n\n        return ( \n            <div className=\"resource-pane\" id=\"resource-pane\" style={{display: this.props.showResourcePane ? \"block\" : \"none\"}}> \n                <div className=\"resource_pane_tab_head\" id=\"resource_pane_tab_head\">\n                     <Modal\n                         modalProps = {newResourceModal}  \n                         onClick = {this.addTab} \n\n                     />\n                    {\n                        this.state.tabs.map((item, i)=> {\n                            const onSetActiveTab = () =>\n                                this.setActiveTab(item.id);\n                                    return(\n                                        <button  \n                                            key={item.id + '_btn'}\n                                            onClick={onSetActiveTab} \n                                            className={this.state.current_tab === item.id ? \"tablinks active\" : \"tablinks\"}\n                                            id={item.id+\"_btn\"}\n                                        >\n                                            {++num}\n                                        </button>\n                                    );\n                        })\n                    }\n                </div>\n                            \n                        <div className=\"tab_body\" id=\"tab_body\">\n                            {this.state.tabs.map((item,i) => {\n                                if(item.type === \"text\"){\n                                this.loadTxtRef = React.createRef();\n                                \n\n                                const handleRemove = () =>\n                                    this.remove_tab(i, item.id);\n                                const clickLoad =() => {        \n                                    this.loadTxtRef.current.click();\n                                }\n\n                                const handleFileUpload = (e) =>{\n                                    this.props.fileManager('load', 'txt', item.id, e.target.files);\n\n                                }\n                                const handleFileDownload = () =>{\n\n                                    this.props.fileManager('save', 'txt', item);\n\n                                }\n                                const handleChangeTitle = (e) =>{\n                                    var titleValue = e.target.value;\n                                    this.updateTab(item.id, titleValue, null)\n                                }\n\n                                const handleChangeContent = (e) =>{\n                                    var contentValue = e.target.value;\n                                    this.updateTab(item.id, null, contentValue)\n                                }\n                                const handleAddAtomFromText = (e) =>{\n                                    this.props.addAtomFromText();\n                                }\n                                return(\n                                    <TabBody\n                                        id={item.id}\n                                        key={item.id + '_bdy'}\n                                        i={i}\n                                        style={{display: this.state.current_tab === item.id ? 'block' : 'none'}}\n\n                                        handleremove={handleRemove}\n                                        handleFileUpload={handleFileUpload}\n                                        handleFileDownload={handleFileDownload}\n                                        clickLoad={clickLoad}\n                                        handleAddAtomFromText = {handleAddAtomFromText}\n                                        selectedText={this.props.selectedText}\n\n\n                                        titleValue={item.metadata.title}\n                                        contentValue = {item.content}\n                                    \n                                        handleChange_title={handleChangeTitle}\n                                        handleChangeContent={handleChangeContent}\n\n\n                                        loadTxtRef={this.loadTxtRef}\n                                        setSelectedText={this.props.setSelectedText}\n                                        setFocus={this.props.setFocus}\n                                       \n                                    />\n                                );\n                            }\n                            })}\n                        </div>\n            </div>\n        );\n    }\n}\nexport default ResourcePane;\n","import React, {Component} from 'react';\nimport Modal from  '../Modal/Modal';\n\nimport cytoscape from 'cytoscape';\nimport cola from 'cytoscape-cola';\nimport edgehandles from 'cytoscape-edgehandles';\nimport $ from 'jquery';\nimport contextMenus from 'cytoscape-context-menus';\n\nimport 'cytoscape-context-menus/cytoscape-context-menus.css';\n\nimport './VisualisationPane.css';\n\n\nimport {remove_falsy,update_scheme, update_atom_metadata, import_json,export_cytoscape,add_atom, sd,add_scheme, add_edge, get_atom, now, new_uuid, update_atom_text, get_sd, delete_edge, update, add_source} from '../../lib/Sadface'; \n\ncytoscape.use( cola );\ncytoscape.use(contextMenus, $);\ncytoscape.use( edgehandles );\n\n\n\nclass Cytoscape extends Component {\n  constructor(props){\n        super(props);\n        //create Refs\n        this.newAtomRef = React.createRef()\n        this.newSchemeRef = React.createRef();\n        this.editContentRef = React.createRef();\n\n        this.state={\n          modalValue: ' ',\n          dropDownValue: ' ',\n\n        }\n        //variables\n        this.cy = null;\n        this.default_sadface_doc= \"{\\\"analyst_email\\\":\\\"\"+this.analyst_email+\"\\\",\\\"analyst_name\\\":\\\"\"+this.analyst_email+\"\\\",\\\"created\\\":\\\"\"+this.created_date+\"\\\",\\\"edges\\\":[],\\\"edited\\\":\\\"\"+this.edited_date+\"\\\",\\\"id\\\":\\\"\"+this.document_id+\"\\\",\\\"metadata\\\":{},\\\"nodes\\\":[],\\\"resources\\\": []}\";\n        this.analyst_email = \"Default Analyst Email\";\n        this.analyst_name = \"Default Analsyst Name\";\n        this.position = null;\n        this.edit_atom=null;\n        this.selected=[];\n        this.redo_stack=[];\n        this.undo_stack=[];\n        this.running = false;\n        //functions\n        this.initialise_monkeypuzzle = this.initialise_monkeypuzzle.bind(this);\n        this.initCytoscape = this.initCytoscape.bind(this);\n\n        this.setModalValue = this.setModalValue.bind(this);\n        this.handleModalValueChange = this.handleModalValueChange.bind(this);\n        this.setDropDownValue = this.setDropDownValue.bind(this);\n        this.handledropDownValue =this.handledropDownValue.bind(this);\n\n\n        \n        this.addScheme = this.addScheme.bind(this);\n        this.editScheme = this.editScheme.bind(this);\n\n        this.addAtom = this.addAtom.bind(this);\n        this.editAtomContent = this.editAtomContent.bind(this);\n        this.editAtomMetadata = this.editAtomMetadata.bind(this);\n        this.deleteAtom = this.deleteAtom.bind(this);\n        this.deleteNodes = this.deleteNodes.bind(this);\n        this.merge_nodes = this.merge_nodes.bind(this);\n\n        this.undo =this.undo.bind(this);\n        this.redrawVisualisation = this.redrawVisualisation.bind(this);\n        this.dragoverHandler = this.dragoverHandler.bind(this);\n        this.dropHandler = this.dropHandler.bind(this);\n\n\n\n    }\n\n    initialise_monkeypuzzle(){\n      //load diagram if there is one in localStorage\n      if (localStorage.getItem(\"state\") !== \"undefined\"){\n//         this.props.loadJSON(localStorage.getItem(\"state\"));\n         this.initCytoscape();\n      \n        \n        // //else use default\n         } else{\n           this.props.setCurrentSadFaceDoc(this.default_sadface_doc);\n        //    localStorage.setItem(\"state\", this.props.current_sadface_doc);\n           this.props.setCyData(export_cytoscape(import_json(this.props.current_sadface_doc)));\n            this.initCytoscape();\n        }\n\n    }\n\n    initCytoscape(){\n      this.cy = cytoscape({\n            container: document.getElementById('cy'),\n            elements: JSON.parse(this.props.cyData),\n\n            style:[\n                {   selector: \"node\", \n                    style: {\n                        \"label\": \"data(content)\",\n                        \"text-opacity\": 0.7,\n                       // \"width\" : \"auto\",\n                    //    \"height\" : \"auto\",\n                        \"text-valign\": \"bottom\",\n                        \"text-halign\": \"right\",\n                        \"text-outline-color\": \"#eee\",\n                        \"text-outline-width\": 1\n                    }\n                },\n                \n                {   selector: \"[typeshape]\", \n                    style: {\n                        \"shape\":\"data(typeshape)\"\n                    }\n                },\n\n                {   selector: \"node[typeshape='diamond']\", \n                    style: {\n                        'background-color': '#CC9900'\n                    }\n                },\n\n                {   selector: \"node[typeshape='diamond'][content='Conflict']\",\n                    style: {\n                        'background-color': 'red'\n                    }\n                },\n\n                {   selector: \"node[typeshape='diamond'][content='Support']\",\n                    style: {\n                        'background-color': 'green'\n                    }\n                },\n\n                {   selector: \"edge\", \n                    style: {\n                        \"line-color\": \"#9dbaea\",\n                        \"target-arrow-shape\": \"triangle\",\n                        \"target-arrow-color\": \"#9dbaea\",\n                        \"curve-style\": \"bezier\"\n                    }\n                },\n\n\n                {   selector: \":selected\", \n                    style: {\n                        \"border-width\":\"1\",\n                        \"border-color\":\"black\",\n                        \"background-color\": \"#3399CC\"\n                    }\n                },\n\n\n                {   selector: \".atom-label\", \n                    style:{\n                        \"text-wrap\": \"wrap\",\n                        \"text-max-width\": 160\n                    }\n                },\n\n                {   selector: \".scheme-label\", \n                    style:{\n                        \"text-wrap\": \"wrap\",\n                        \"text-max-width\": 160\n                    }\n                },\n                {   selector: '.eh-handle',\n                    style: {\n                        'background-color': 'orange',\n                        'width': 10,\n                        'height': 10,\n                        'shape': 'ellipse',\n                        'overlay-opacity': 0,\n                        'border-width': 8, // makes the handle easier to hit\n                        'border-opacity': 0,\n                        'label': '',\n                    }\n                }\n                \n            ],\n\n            boxSelectionEnabled: false,\n            autounselectify: false,\n            selectionType: \"single\",\n            minZoom: 0.1,\n            maxZoom: 1.5\n      });//cytoscapefunction\n        \n   \n      this.layout = this.build_cola_layout();\n      this.layout.run();\n\n      this.cy.edgehandles({\n                toggleOffOnLeave: true,\n                handleNodes: \"node\",\n                handleSize: 10,\n                handleColor: \"#DF0085\",\n                handleHitThreshold: 8,\n                handleLineWidth: 5,\n                //handleLineType: \"flat\",\n                edgeType: function(){ return \"flat\"; },\n                complete: function(event, sourceNode, targetNode, addedEles){\n                    if (targetNode.length !== 0) {\n                        var source_id = targetNode[0].source().id();\n                        var target_id = targetNode[0].target().id();\n\n                        //get the mid point between source node and target node\n                        var source_position = targetNode[0].source().position();\n                        var target_position = targetNode[0].target().position();\n\n                        this.position = {};\n                        this.position.x = ((source_position.x + target_position.x)/2);\n                        this.position.y = ((source_position.y + target_position.y)/2);\n\n                        if (targetNode[0].source().data().type === \"atom\" && targetNode[0].target().data().type === \"atom\")\n                        {\n                            var scheme = add_scheme(\"Support\");\n                            var scheme_id = scheme.id;\n                            var scheme_content = scheme.name;\n                            //remove the automatically generated edge\n                            targetNode.remove();\n                            this.cy.add([\n                                {group: \"nodes\", data: {id: scheme_id.toString(),\n                                    content: scheme_content, typeshape: \"diamond\" }, classes: \"scheme-label\", locked: false, position: this.position}\n                                    ]);\n                            var edge1 = add_edge(source_id, scheme_id);\n                            var edge2 = add_edge(scheme_id, target_id);\n                            this.cy.add([\n                              { group: \"edges\", data: { id: edge1.id.toString(), source: source_id, target: scheme_id } },\n                              { group: \"edges\", data: { id: edge2.id.toString(), source: scheme_id, target: target_id } }\n                              ]);\n                        } else {\n                            targetNode.remove();\n                            var edge = add_edge(source_id, target_id);\n                            this.cy.add([\n                              { group: \"edges\", data: { id: edge.id.toString(), source: source_id, target: target_id } }\n                              ]);\n                        }\n                        this.props.updateLocalStorage();\n                    } else {\n                        targetNode.remove();\n                    }\n                }.bind(this)\n            });//edgehandles\n\n      /*\n     *\n     * Set up context menus\n     *\n     * */\n    this.cm = this.cy.contextMenus({\n               menuItems: [\n                    {\n                        id: \"edit-content\",\n                        content: \"edit content\",\n                        selector: \"node[type = \\\"atom\\\"]\",\n                        onClickFunction: function (event) {\n                            let target = event.target || event.cyTarget;\n                            document.getElementById(\"editContentTrigger\").click();\n                             this.setModalValue(target.data().content);\n                            this.edit_atom = target;\n                        }.bind(this),\n                        hasTrailingDivider: false\n                    },\n\n                    {\n                        id: \"edit-metadata\",\n                        content: \"edit metadata\",\n                        selector: \"node[type = \\\"atom\\\"]\",\n                        onClickFunction: function (event) {\n                              let target = event.target || event.cyTarget;\n                              let meta = JSON.stringify(target.data().metadata);\n                              document.getElementById(\"editMetaTrigger\").click();\n                              this.setModalValue(meta);\n                             this.edit_atom = target;\n                         }.bind(this),\n                         hasTrailingDivider: true\n                    },\n                    {\n                        id: \"change-scheme\",\n                        content: \"change scheme\",\n                        selector: \"node[typeshape = \\\"diamond\\\"]\",\n                        onClickFunction: function (event) {\n                            var target = event.target || event.cyTarget;\n                            this.setDropDownValue(target.data().content);\n                            document.getElementById(\"editSchemeTrigger\").click();\n                            this.edit_atom = target;\n                        }.bind(this),\n                        hasTrailingDivider: true\n                    },\n                    {\n                        id: \"remove\",\n                        content: \"remove\",\n                        selector: \"node, edge\",\n                        onClickFunction: function (event) {\n                            var target = event.target || event.cyTarget;\n                            if (this.selected.length !== 0) {\n                                this.selected.forEach(function(node) {\n                                    console.log(node, \"SELECTED\");\n                                    this.deleteNodes(node);\n                                }.bind(this));\n                                this.selected = [];\n                            } else {\n                                if (target.data().type === \"atom\") {\n                                    this.deleteNodes(event);\n                                    target.remove();\n                                } else if (target.data().typeshape === \"diamond\"){\n                                    this.deleteNodes(event);\n                                    target.remove();\n                                } else {\n                                    delete_edge(target.id());\n                                    this.updateLocalStorage();\n                                    target.remove();\n                                }\n                            }\n                        }.bind(this),\n                        hasTrailingDivider: true\n                    },\n                    {\n                        id: \"add-atom\",\n                        content: \"add atom\",\n                        coreAsWell: true,\n\n                        onClickFunction: function (event) {\n                            this.position = event.renderedPosition;\n                         this.setModalValue(\"\");\n                            document.getElementById(\"newAtomTrigger\").click();\n                        }.bind(this)\n                    },\n                    {\n                        id: \"add-scheme\",\n                        content: \"add scheme\",\n                        coreAsWell: true,\n                        onClickFunction: function (event) {\n\n                            this.position = event.position || event.cyPosition;\n                            this.setDropDownValue(\"Support\");\n                                document.getElementById(\"new_scheme\").click();\n                        }.bind(this),\n                        hasTrailingDivider: true\n                    },\n                    {\n                        id: \"redraw\",\n                        content: \"redraw\",\n                        coreAsWell: true,\n                        onClickFunction:  (event) => this.redrawVisualisation(),\n                        hasTrailingDivider: true\n                    },\n                    {\n                        id: \"undo\",\n                        content: \"undo\",\n                        selector: \"node, edge\",\n                        show: true,\n                        coreAsWell: true,\n                        onClickFunction:  (event) => this.undo(),\n                        hasTrailingDivider: false\n                    },\n                    {\n                        id: \"redo\",\n                        content: \"redo\",\n                        selector: \"node, edge\",\n                        show: false,\n                        coreAsWell: true,\n                        onClickFunction: function (event) {\n                          this.redo();\n                          if (this.redo_stack === []) {\n                            this.cm.hideMenuItem(\"redo\");\n                        }\n                        }.bind(this),\n                        hasTrailingDivider: true\n                    },\n                    {\n                      id: \"merge_nodes\",\n                      content: \"merge nodes\",\n                      selector: \"node\",\n                      tooltipText: \"hello\",\n                      show: false,\n                      coreAsWell: true,\n                      onClickFunction:  (event) => this.merge_nodes()\n                    }\n                ],//menuitems\n            });//close context menues\nthis.cy.on(\"layoutstart\", function(){\n                this.running = true;\n            });\n\n this.cy.on(\"layoutstop\", function(){\n                this.running = false;\n        \n                var png = this.cy.png({ full: true });\n                this.props.handleSetPng(png);\n\n                var jpg = this.cy.jpg({ full: true });\n                this.props.handleSetJpg(jpg);\n            }.bind(this));\n            \n\n    }//initmonkeyPuzzle\n\n    build_cola_layout( opts ) {\n        var cola_params = {\n            name: \"cola\",\n            animate: true,\n            randomize: true,\n            padding: 100,\n            fit: false,\n            maxSimulationTime: 1500\n        };\n        var i = 0;\n        if (opts !== undefined) {\n            opts.forEach(function(opt) {\n             cola_params[i] = opts[i];\n             ++i;\n         });\n        }\n        return this.cy.makeLayout( cola_params );\n    }\n    merge_nodes(){\n\n    }\n\n    setModalValue(newModalValue){\n        console.log(newModalValue, \"NEWModalValue\")\n        this.setState({modalValue: newModalValue}, () =>\n         console.log(this.state.modalValue, 'modal value set'));\n    }\n\n    handleModalValueChange(e) {\n        console.log(e.target.value, \"E\");\n     this.setState({modalValue: e.target.value}, () =>\n        console.log(this.state.modalValue,  \"modal value set\"));\n}\n\n    setDropDownValue(newDropDownValue){\n    this.setState({dropDownValue: newDropDownValue}, () =>\n        console.log(this.state.dropDownValue, 'modal value set'));\n}\n\nhandledropDownValue(e){\n    this.setState({dropDownValue: e.target.value}, () =>\n    console.log(this.state.dropDownValue, 'dropdown value'));\n}\n    addAtom(content=null) {\n        console.log(this.state.modalValue, \"modal value\");\n    if(content === null){\n        content = this.state.modalValue;\n    }\n    if(content === \"\"){\n        content = \"New Atom\";\n    }\n    var meta = {\"hello\":\"world\"};\n    var new_atom = add_atom(content);\n    var atom_id = new_atom.id;\n    if (this.props.focused != null) {\n        add_source(atom_id, this.props.focused.id, content, 0, 0);\n    }\n    if (this.position == null) {\n        this.position = {\"x\": this.cy.width()/2, \"y\": this.cy.height()/2};\n    }\n    this.cy.add([\n        {group: \"nodes\", data: {id: atom_id.toString(),\n            content: content, type: \"atom\", typeshape: \"roundrectangle\", metadata: meta }, \n            classes: \"atom-label\", locked: false, renderedPosition: this.position}\n    ]);\n\n    let node = this.cy.getElementById(atom_id.toString() );\n\n    this.position = null;\n    this.props.updateLocalStorage();\n\n}\n\n addScheme() {\n    let scheme = this.state.dropDownValue;\n    var new_scheme = add_scheme(scheme);\n    var scheme_id = new_scheme.id;\n\n    this.cy.add([\n        {group: \"nodes\", data: {id: scheme_id.toString(),\n            content: scheme, type: \"scheme\", typeshape: \"diamond\" }, classes: \"scheme-label\", locked: false, position: this.position}\n    ]);\n    this.props.updateLocalStorage();\n}\n\neditScheme(){\n    let content = this.state.dropDownValue;\n    let scheme = this.cy.$(\"#\"+this.edit_atom.id());\n    update_scheme(this.edit_atom.id(), content);\n    this.props.updateLocalStorage();\n    scheme.data(\"content\", content);\n    this.edit_atom = null;\n\n}\neditAtomContent() {\n    let editContent = this.state.modalValue;\n    let atom = this.cy.$(\"#\"+this.edit_atom.id());\n    update_atom_text(this.edit_atom.id(), editContent);\n    this.props.updateLocalStorage();\n    atom.data(\"content\", editContent);\n    this.edit_atom = null;\n}\n\neditAtomMetadata() {\n  let atom = this.cy.$(\"#\"+this.edit_atom.id());\n  let content = this.state.modalValue;\n  if(JSON.parse(content)){\n    let metadata = JSON.parse(content);\n    update_atom_metadata(atom.id(), metadata);\n    this.props.updateLocalStorage();\n    this.edit_atom=null;\n  }else {\n        alert(\"Metadata not in JSON format, unable to update\");\n    }\n             \n}\ndeleteAtom(atom_id) {\n    /*\n    Remove the atom from the sadface document identified by the\n    supplied atom ID\n    */\n    console.log(atom_id, \"AtomID\");\n    if (atom_id) {\n        var atom = get_atom(atom_id);\n        console.log(atom, \"ATOM\");\n        if (atom !== null && atom !== undefined) {\n            var size = Object.keys(sd.nodes).length;\n            for (var i = 0; i < size; ++i) {\n                if (sd.nodes[i].id === atom.id) {\n                    delete sd.nodes[i];\n                   sd.nodes = remove_falsy(sd.nodes);\n                        return;\n                }\n            }\n        }\n    }\n}\n\ndeleteNodes(event) {\n    var target = event.target || event.cyTarget;\n    var id = target.id();\n    let removed = target.remove();\n    this.deleteAtom(id);\n    var i = 0;\n    var sds = get_sd();\n    var edges = sds.edges;\n    edges.forEach(function(edge) {\n        if (edges[i] !== undefined) {\n            if (edges[i].source_id === id || edges[i].target_id === id) {\n                delete_edge(edges[i].id);\n            }\n            ++i;\n        }\n    });\n    this.props.updateLocalStorage();\n}\n\nundo() {\n    // if(this.props.undo_stack.length != 0){\n    //     let redo_item = get_sd();\n    //     this.props.setRedoStack(redo_item);\n    //     let state = this.props.undo_stack[this.props.undo_stack.length - 1];\n    //     console.log(this.props.undo_stack, \"state\");\n    //     this.props.loadJSON(JSON.stringify(state));\n\n    // }\n\n        }\n\n   \n\n\n\n\nredrawVisualisation() {\n    this.layout.stop();\n    this.layout.options.eles = this.cy.elements();\n    this.layout.run();\n    this.cy.center();\n    this.cy.resize();\n}\n\ndragoverHandler(ev) {\n    console.log(\"dragoverHandler\");\n     ev.preventDefault();\n     ev.dataTransfer.dropEffect = \"move\";\n}\n\ndropHandler(ev) {\n    ev.preventDefault();\n    this.position = {x: ev.clientX-300, y: ev.clientY};\n \n    if(this.props.selectedText !== null || this.props.selectedText != undefined){\n        this.addAtom(this.props.selectedText);\n        this.props.clearSelection();\n    }\n    else { console.log(\"Not a valid text selection.\"); }\n}\n\n    componentDidMount(){\n       this.initialise_monkeypuzzle();\n       }\n\n    static getDerivedStateFromProps(nextProps, prevState) {\n          if(nextProps.cyData !== prevState.cyData){\n              return{cyData: nextProps.cyData};\n              this.initialise_monkeypuzzle();\n          }\n         else return null;\n         if(nextProps.newAtomFromText !== prevState.newAtomFromText){\n            return{newAtomFromText: nextProps.cyData};\n         }else return null;\n      }\n    componentDidUpdate(prevProps, prevState) {\n      if(prevProps.cyData!==this.props.cyData){\n        //Perform some operation here\n        this.initialise_monkeypuzzle();\n      }\n      if(this.props.newAtomFromText === true){\n        console.log(\"new atom from text\");\n        this.addAtom(this.props.selectedText);\n        this.props.addAtomFromText();\n        this.props.clearSelection();\n      }\n      if(prevProps.showResourcePane !== this.props.showResourcePane){\n        this.redrawVisualisation();\n      }\n    }\n    render(){\n        /* New Atom Modal */\n        const newAtomModal = {\n            trigger: {\n                triggerText: 'New Atom',\n                triggerId: 'newAtomTrigger'\n            },\n              title: 'New Atom',\n              id: 'newAtomModal',\n              content: <div className=\"modal-body\">\n              <p>Add some content to the new atom</p>\n              <div className=\"form-group\">\n              <textarea \n                className=\"form-control\" \n                rows=\"2\" \n                id=\"new_atom_content\" \n                onChange={this.handleModalValueChange}\n                >\n              </textarea></div></div>,\n            footer: {\n                buttonNo:2,\n                button1: {\n                  className: \"btn btn-secondary\",\n                  value: \"Close\"\n                },\n                button2: {\n                  className: 'btn btn-primary',\n                  value: 'Create',\n                },\n            }\n        };\n\n        /* New Scheme Modal*/\n        var newSchemeModal = {\n            trigger: {\n                triggerText: 'New Scheme',\n                className: \"new_scheme\",\n                triggerId: \"new_scheme\",\n            },\n              id:\"newSchemeModal\",\n              title: 'New Scheme',\n              content: <div className=\"modal-body\">\n              <p>Select a scheme</p>\n              <select \n                className=\"form-control\" \n                id=\"sel1\" \n                value={this.state.dropDownValue}\n                onChange={this.handledropDownValue}\n                >\n              <option>Support</option>\n              <option>Conflict</option>\n              <option>Argument from Sign</option>\n              <option>Argument from an Exceptional Case</option>\n              <option>Argument from Analogy</option>\n              <option>Argument from Bias</option>\n              <option>Argument from Cause to Effect</option>\n              <option>Argument from Correlation to Causes</option>\n              <option>Argument from Established Rule</option>\n              <option>Argument from Evidence to a Hypothesis</option>\n              <option>Argument from Falsification to a Hypothesis</option>\n              <option>Argument from Example</option>\n              <option>Argument from Commitment</option>\n              <option>Circumstantial Argument Against the Person</option>\n              <option>Argument from Popular Practice</option>\n              <option>Argument from Popularity</option>\n              <option>Argument from Position to Know</option>\n              <option>Argument from Expert Opinion</option>\n              <option>Argument from Precedent</option>\n              <option>Argument from Consequences</option>\n              <option>Argument from Waste</option>\n              <option>Causal Slippery Slope Argument</option>\n              </select>\n              </div>,\n            footer: {\n                buttonNo: 2,\n                button1: {\n                  className: \"btn btn-secondary\",\n                  value: \"Close\"\n                },\n                button2: {\n                  className: \"btn btn-primary\",\n                  value: \"Create\"\n                }\n            }\n        };\n\n        /* Edit Content Modal */\n        var editContentModal = {\n            trigger: {\n                triggerText: 'editContentTrigger',\n                className: \"editContentTrigger\",\n                triggerId: \"editContentTrigger\",\n            },\n            id: 'editContentModal',\n            title: 'Edit Atom Content',\n            content: <div className=\"modal-body\">\n            <p>Edit atom content</p>\n            <div className=\"form-group\">\n            <textarea \n                className=\"form-control\" \n                rows=\"2\" \n                id=\"edit_atom_content_textarea\"\n                ref={this.editContentRef}\n                value={this.state.modalValue}\n                onChange={this.handleModalValueChange}\n                ></textarea>\n                </div>\n                </div>,\n            footer: {\n                buttonNo: 2,\n                button1:{\n                    className: \"btn btn-secondary\",\n                    value: \"Close\"\n                },\n                button2: {\n                    className: 'btn btn-primary',\n                    value: 'Save',\n                }\n            }\n        };\n\n        /* Edit Metadata Modal  */\n\n            var editMetaDataModal = {\n                trigger:{\n                    triggerText: 'Edit Meta',\n                    className: 'editMeta',\n                    triggerId: 'editMetaTrigger',\n                },\n                id: 'editMetadataModal',\n                title: 'Edit Metadata',\n                content: <div className=\"modal-body\">\n                <p>Edit atom content</p>\n                <div className=\"form-group\" id=\"edit_metadata\">\n                <textarea \n                    className=\"form-control\" \n                    rows=\"2\" \n                    id=\"edit_atom_content\"\n                    value={this.state.modalValue}\n                    onChange={this.handleModalValueChange}\n\n                    >\n                </textarea>\n                </div>\n                </div>,\n                footer: {\n                    buttonNo: 2,\n                    button1: {\n                        className: 'btn btn-secondary',\n                        value: 'Close',\n                    },\n                    button2: {\n                        className: 'btn btn-primary',\n                        value: 'Save',\n                    },  \n                },\n            };\n\n            /* Edit Scheme Type Modal */\n\n                var editSchemeTypeModal = {\n                  trigger:{\n                    triggerText: 'Edit Scheme Type',\n                    className: 'editScheme',\n                    triggerId: 'editSchemeTrigger',\n                  },\n                  id: 'editSchemeModal',\n                  title: 'Edit Scheme',\n                  content: <div className=\"modal-body\">\n                  <p>Select a scheme</p>\n                  <select \n                    className=\"form-control\" \n                    id=\"sel2\"\n                    onChange={this.handledropDownValue}\n                    value={this.state.dropDownValue}\n                        >\n                  <option>Support</option>\n                  <option>Conflict</option>\n                  <option>Argument from Sign</option>\n                  <option>Argument from an Exceptional Case</option>\n                  <option>Argument from Analogy</option>\n                  <option>Argument from Bias</option>\n                  <option>Argument from Cause to Effect</option>\n                  <option>Argument from Correlation to Causes</option>\n                  <option>Argument from Established Rule</option>\n                  <option>Argument from Evidence to a Hypothesis</option>\n                  <option>Argument from Falsification to a Hypothesis</option>\n                  <option>Argument from Example</option>\n                  <option>Argument from Commitment</option>\n                  <option>Circumstantial Argument Against the Person</option>\n                  <option>Argument from Popular Practice</option>\n                  <option>Argument from Popularity</option>\n                  <option>Argument from Position to Know</option>\n                  <option>Argument from Expert Opinion</option>\n                  <option>Argument from Precedent</option>\n                  <option>Argument from Consequences</option>\n                  <option>Argument from Waste</option>\n                  <option>Causal Slippery Slope Argument</option>\n                  </select>\n                  </div>,\n                  footer: {\n                    buttonNo: 2,\n                    button1: {\n                      className: 'btn btn-secondary',\n                      value: 'Close',\n                    },\n                    button2: {\n                      className:'btn btn-primary',\n                      value: 'Save',\n                    },\n                  } \n                };\n\n      return(\n        <div>\n        <Modal\n            modalProps={newAtomModal}\n            show=\"none\"\n            onClick={this.addAtom}\n        />\n      <Modal\n            modalProps={newSchemeModal}\n            show=\"none\"\n            onClick={this.addScheme}\n        />\n\n        <Modal\n            modalProps={editContentModal}\n            show=\"none\"\n            onClick={this.editAtomContent}\n        />\n\n        <Modal\n            modalProps={editMetaDataModal}\n            show=\"none\"\n            onClick={this.editAtomMetadata}\n        />\n\n         <Modal\n            modalProps={editSchemeTypeModal}\n            show=\"none\"\n            onClick={this.editScheme}\n        />\n         <div id=\"cy\" onDrop={this.dropHandler} onDragOver={this.dragoverHandler}>\n\n      </div>\n        </div>);\n\n  }\n}\n\nexport default Cytoscape;","import React, {Component} from 'react';\nimport Slideout from 'slideout';\n\n//import Components\nimport Menu from './Components/Menu/Menu';\nimport MenuTrigger from './Components/Menu/MenuTrigger';\nimport ResourcePane from './Components/ResourcePane/ResourceHead/ResourcePane';\nimport VisualisationPane from './Components/VisualisationPane/VisualisationPane';\n\n\nimport './App.css';\n\n\n//import fuctions from SADFACE\n\nimport {update,add_resource, add_resource_metadata,download, update_resource,remove_resources_from_nodes, loadSADFace,saveSADFace, delete_resource, get_sd,import_json, export_cytoscape} from './lib/Sadface'; \n\n\n\nclass App extends Component{\n\tconstructor(props){\n\t\tsuper(props);\n\t\tthis.state = {\n            showResourcePane: true,\n            newResource: null,\n            resourcesFromJson: null,\n            selectedText:'',\n            cyData: null,\n            jpg:'',\n            png: '',\n            fileName:'',\n            json: '',\n            current_sadface_doc:null,\n            \n            focused: null,\n            newAtomFromText: false,\n            uploadSADFACE: null,\n\n            undo_stack:[],\n            redo_stack:[],\n        };\n\n\n        this.toggleMenu = this.toggleMenu.bind(this);\n        this.loadJSON = this.loadJSON.bind(this);\n        this.fileManager = this.fileManager.bind(this);\n        this.setCyData = this.setCyData.bind(this);\n\n        //ResourcePane Functions\n        this.toggleResourcePane =this.toggleResourcePane.bind(this);\n        this.setNewResource =this.setNewResource.bind(this);\n        this.setResourcesFromJson = this.setResourcesFromJson.bind(this);\n\n\n        this.setSelectedText = this.setSelectedText.bind(this);\n        this.addAtomFromText = this.addAtomFromText.bind(this);\n        //Menu\n        this.handleSetPng = this.handleSetPng.bind(this);\n        this.handleSetJpg = this.handleSetJpg.bind(this);\n        this.load_demo_argument = this.load_demo_argument.bind(this);\n        this.setFileName = this.setFileName.bind(this);\n        //Cytoscape\n        this.clearSelection = this.clearSelection.bind(this);\n        this.setCurrentSadFaceDoc = this.setCurrentSadFaceDoc.bind(this);\n        this.updateLocalStorage = this.updateLocalStorage.bind(this);\n        this.setFocus = this.setFocus.bind(this);\n        this.setUndoStack =this.setUndoStack.bind(this);\n        this.setRedoStack = this.setRedoStack.bind(this);\n\n        this.returnSD = this.returnSD.bind(this);\n    }\n\n  \nupdateLocalStorage() {\n    var undo_item = JSON.parse(this.state.current_sadface_doc);   \n    this.setUndoStack(undo_item);\n    this.setRedoStack([])\n    localStorage.setItem(\"state\", JSON.stringify(get_sd()));\n    this.setCurrentSadFaceDoc(JSON.stringify(get_sd()));\n    update();\n}\n\nsetUndoStack(undo_item){\n  this.setState({\n            undo_stack: [...this.state.undo_stack, undo_item]\n        }, () => console.log(this.state.undo_stack, \"undoStack\"));\n\n}\n\nsetRedoStack(val){\n  this.setState({\n      redo_stack: val\n    }, () => console.log(this.state.redo_stack,\"redoStack\"));\n\n}\n\nsetCurrentSadFaceDoc(value){\n    this.setState({current_sadface_doc: value}, () =>\n        console.log(\"current sad face doc updated\" ));\n}\n\n\n\naddAtomFromText(){\n  console.log(\"addAtomFromText\");\n       this.setState({newAtomFromText: !this.state.newAtomFromText}, () =>\n           console.log(this.state.newAtomFromText, \"set newAtomFromText\"));\n}\n\n//Menu function\nhandleSetPng(png){\n    this.setState({png: png}, () =>\n        console.log(this.state.png, 'PNG set'));\n}\n\nhandleSetJpg(jpg){\n    this.setState({jpg: jpg}, () =>\n        console.log('JPG set'));\n}\n\ncomponentDidMount() {\n    this.slideout = new Slideout({\n        'panel': document.getElementById('panel'),\n        'menu': document.getElementById('menu'),\n        \"fx\": \"ease\",\n        \"side\": \"right\",\n        \"duration\": 500,\n        \"padding\": 256,\n        \"tolerance\": 70,\n    });\n}\n\ntoggleMenu(){\n    this.slideout.toggle();\n}\n\nfileManager(operation, filetype, tab, files) {\n    /*\n    Write text from tab to file or does a SADFace save operation\n    */\n\n    if (\"save\" === operation)    {\n        let filename = '';\n        // if it's a txt file\n        if (\"txt\" === filetype) {   \n\n            if (tab.metadata.title !== '') {\n                 filename = tab.metadata.title+\".txt\";\n            } else {\n                 filename = \"tab \"+tab.id+\"_text.txt\";\n            }\n            let text = tab.content;\n            download(filename,text);\n        }\n        \n        // if it's a JSON file\n        if (\"json\" === filetype) {\n           let filename = this.state.fileName;\n            if(filename.length === 0){ filename = \"default\"}\n               saveSADFace(filename, filetype);\n        }\n    }\n    \n    //if it's a load operation\n    if (\"load\" === operation) {\n        // if it's a txt file\n        if (\"txt\" === filetype) {\n            \n            \n            let file = files[0];\n            let filename = file.name;\n            let reader = new FileReader();      \n            reader.onload = function(e) {\n                var content = reader.result;\n                update_resource(tab.id, content, filename);\n                let newResource = {};\n                newResource.tab = tab;\n                newResource.filename = filename;\n                newResource.content =content;\n                this.setNewResource(newResource);\n            }.bind(this);\n            reader.readAsText(file);\n        }\n        // if it's a JSON file\n        if (\"json\" === filetype) {\n           // let files = document.getElementById(\"loadJSON\").files;\n            let file = files[0];\n            let reader = loadSADFace(file);\n            if (reader !== null){\n            reader.onload = function(e) {\n                let result = reader.result;\n                localStorage.setItem(\"state\",result);\n              this.loadJSON(result);\n            }.bind(this);\n        }\n        }\n    }\n}\n\nsetNewResource(value){\n  this.setState({newResource: value}, () =>\n    console.log(this.state.newResource, 'newresource set'));\n}\n\n loadJSON(json_value) {\n      console.log(json_value);\n     if(json_value != null){\n     let importJSON = import_json(json_value);\n      localStorage.setItem(\"state\",JSON.stringify(get_sd()));\n      this.setCurrentSadFaceDoc(JSON.stringify(get_sd()));\n      this.setResourcesFromJson(importJSON.resources);\n      this.setCyData(export_cytoscape(importJSON)); \n      }  \n } \n\n setResourcesFromJson(value){\n  this.setState({resourcesFromJson: value}, () =>\n    console.log(this.state.resourcesFromJson, \"resourcesFromJson set\"))\n }\n\nsetSelectedText(text){\n    if(text!== null && text.length > 1){\n        this.setState((state) => ({\n        selectedText: text,\n    }), () =>\n    console.log(this.state.selectedText, \"setSelectedText\"));\n\n    }else{\n       this.clearSelection();   \n       }    \n}\n\n setFocus(element){    \n         this.setState({focused: element}, () =>\n         console.log(this.state.focused, 'focus set'));\n }\n\nclearSelection() {\n    this.setState(() => ({\n        selectedText: '',\n    }), () => console.log(this.state.selectedText, \"clear selection\"));\n}\n\n// Slide In Functions\ntoggleResourcePane(){\n    this.setState({showResourcePane: !this.state.showResourcePane})\n}\n\n setFileName(file_name){\n    this.setState({fileName: file_name}, () => \n      console.log(this.state.fileName, 'filename app'));\n  }\n\nload_demo_argument(){\n   var demo_sadface_doc = \"{\\\"analyst_email\\\":\\\"40170722@live.napier.ac.uk\\\",\\\"analyst_name\\\":\\\"Nathan Mair\\\",\\\"created\\\":\\\"2018-02-23T02:27:36\\\",\\\"edges\\\":[{\\\"id\\\":\\\"a1s1\\\",\\\"source_id\\\":\\\"a1\\\",\\\"target_id\\\":\\\"s1\\\"},{\\\"id\\\":\\\"a2s1\\\",\\\"source_id\\\":\\\"a2\\\",\\\"target_id\\\":\\\"s1\\\"},{\\\"id\\\":\\\"a3s2\\\",\\\"source_id\\\":\\\"a3\\\",\\\"target_id\\\":\\\"s2\\\"},{\\\"id\\\":\\\"s2a5\\\",\\\"source_id\\\":\\\"s2\\\",\\\"target_id\\\":\\\"a5\\\"},{\\\"id\\\":\\\"s1a4\\\",\\\"source_id\\\":\\\"s1\\\",\\\"target_id\\\":\\\"a4\\\"},{\\\"id\\\":\\\"a4s2\\\",\\\"source_id\\\":\\\"a4\\\",\\\"target_id\\\":\\\"s2\\\"}],\\\"edited\\\":\\\"2018-02-23T02:27:36\\\",\\\"id\\\":\\\"94a975db-25ae-4d25-93cc-1c07c932e2f9\\\",\\\"metadata\\\":{},\\\"nodes\\\":[{\\\"id\\\":\\\"a1\\\",\\\"metadata\\\":{},\\\"sources\\\":[],\\\"text\\\":\\\"Every person is going to die\\\",\\\"type\\\":\\\"atom\\\"},{\\\"id\\\":\\\"a2\\\",\\\"metadata\\\":{},\\\"sources\\\":[],\\\"text\\\":\\\"You are a person\\\",\\\"type\\\":\\\"atom\\\"},{\\\"id\\\":\\\"a3\\\",\\\"metadata\\\":{\\\"test\\\":\\\"test\\\"},\\\"sources\\\":[],\\\"text\\\":\\\"If you are going to die then you should treasure every moment\\\",\\\"type\\\":\\\"atom\\\"},{\\\"id\\\":\\\"a4\\\",\\\"metadata\\\":{},\\\"sources\\\":[],\\\"text\\\":\\\"You are going to die\\\",\\\"type\\\":\\\"atom\\\"},{\\\"id\\\":\\\"a5\\\",\\\"metadata\\\":{},\\\"sources\\\":[],\\\"text\\\":\\\"You should treasure every moment\\\",\\\"type\\\":\\\"atom\\\"},{\\\"id\\\":\\\"s1\\\",\\\"name\\\":\\\"Support\\\",\\\"type\\\":\\\"scheme\\\"},{\\\"id\\\":\\\"s2\\\",\\\"name\\\":\\\"Support\\\",\\\"type\\\":\\\"scheme\\\"}],\\\"resources\\\": []}\";\n\n    localStorage.setItem(\"state\",demo_sadface_doc);\n    this.setCyData(export_cytoscape(import_json(demo_sadface_doc)))\n    //this.setState({cy_data: export_cytoscape(import_json(demo_sadface_doc))}, () =>\n    //    console.log(this.state.cy_data, 'cy_data'));\n}\n\nsetCyData(val){\n    this.setState({cyData: val},() =>\n        console.log(\"cydata set\"));\n}\n\nreturnSD(){\n  let sd = get_sd();\n  console.log(sd);\n}\n\n\n\nrender(){\n\n    return (\n    \t<div>\n    \t<Menu \n        //functions\n        toggleResourcePane={this.toggleResourcePane}\n        load_demo_argument={this.load_demo_argument}\n        setFileName={this.setFileName}\n        fileManager={this.fileManager}\n        setUploadSADFACE={this.setUploadSADFACE}\n        //state\n        png={this.state.png}\n        jpg={this.state.jpg}\n        fileName = {this.state.fileName}\n        />\n\n        <main id=\"panel\" className=\"panel\">\n\n        <div className=\"ui-container\">\n          <ResourcePane \n            //state\n            showResourcePane={this.state.showResourcePane}\n            newResource={this.state.newResource}\n            resourcesFromJson={this.state.resourcesFromJson}\n            selectedText={this.state.selectedText}\n            //functions\n            updateLocalStorage={this.updateLocalStorage}\n            fileManager={this.fileManager}\n            setFocus={this.setFocus}\n            setSelectedText={this.setSelectedText}\n            addAtomFromText={this.addAtomFromText}\n\n\n         />\n          <div className=\"splitter\" id=\"splitter\">\n          </div>\n\n          <div className=\"visualisation-pane\">\n              <div id=\"navbar\">\n                 \n                  <MenuTrigger\n                    className=\"btn-hamburger toggle-button\"\n                    onClick={this.toggleMenu}\n                  />\n              </div>\n              <VisualisationPane\n                //state\n                showResourcePane = {this.state.showResourcePane}\n                cyData= {this.state.cyData}\n                newAtomFromText = {this.state.newAtomFromText}\n                selectedText = {this.state.selectedText}\n                focused = {this.state.focused}\n                newAtomFromText={this.state.newAtomFromText}\n                current_sadface_doc = {this.state.current_sadface_doc}\n                undo_stack = {this.state.undo_stack}\n                redo_stack = {this.state.redo_stack}\n                setRedoStack= {this.setRedoStack}\n                setUndoStack = {this.setUndoStack}\n\n\n\n                //function\n                addAtomFromText={this.addAtomFromText}\n                handleSetPng = {this.handleSetPng}\n                handleSetJpg = {this.handleSetJpg}\n                loadJSON = {this.loadJSON}\n                setCurrentSadFaceDoc={this.setCurrentSadFaceDoc}\n                setCyData={this.setCyData}\n                updateLocalStorage={this.updateLocalStorage}\n                clearSelection ={this.clearSelection}\n              />\n              \n          </div>\n      </div>\n        </main>\n        </div>\n\n        );\n}\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\nimport 'bootstrap/dist/css/bootstrap.min.css';\n\n\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}