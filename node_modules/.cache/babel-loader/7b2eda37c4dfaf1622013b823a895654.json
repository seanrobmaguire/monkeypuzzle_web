{"ast":null,"code":"var _jsxFileName = \"/Users/gareth/Desktop/monkeypuzzle/src/Components/CytoContainer.js\";\nimport React, { Component } from 'react';\nimport cytoscape from 'cytoscape';\nimport cola from 'cytoscape-cola';\nimport edgehandles from 'cytoscape-edgehandles'; //import functions\n\nimport { now, new_uuid } from '../lib/Sadface';\ncytoscape.use(edgehandles);\ncytoscape.use(cola);\nvar cy = null;\nvar cm = null;\nvar selected = [];\nvar position = null;\nvar layout = null;\nvar running = false;\nvar cy_data = {};\nvar json;\nvar created_date = now();\nvar edited_date = now();\nvar analyst_email = \"Default Analyst Email\";\nvar analyst_name = \"Default Analsyst Name\";\nvar document_id = new_uuid();\nvar default_sadface_doc = \"{\\\"analyst_email\\\":\\\"\" + analyst_email + \"\\\",\\\"analyst_name\\\":\\\"\" + analyst_email + \"\\\",\\\"created\\\":\\\"\" + created_date + \"\\\",\\\"edges\\\":[],\\\"edited\\\":\\\"\" + edited_date + \"\\\",\\\"id\\\":\\\"\" + document_id + \"\\\",\\\"metadata\\\":{},\\\"nodes\\\":[],\\\"resources\\\": []}\";\nvar current_sadface_doc = null;\nvar focused = null;\nvar undo_stack = [];\nvar redo_stack = [];\nvar edit_atom = null;\nvar resource_pane_viewable_state = true;\ninitialise_monkeypuzzle();\n\nfunction initialise_monkeypuzzle() {\n  //load diagram if there is one in localStorage\n  if (localStorage.getItem(\"state\")) {\n    loadJSON(localStorage.getItem(\"state\"));\n    initCytoscape(); //else use default\n  } else {\n    current_sadface_doc = default_sadface_doc;\n    localStorage.setItem(\"state\", current_sadface_doc);\n    cy_data = export_cytoscape(import_json(current_sadface_doc));\n    initCytoscape();\n  }\n}\n\nfunction initCytoscape() {\n  cy = cytoscape({\n    container: document.getElementById(\"cy\"),\n    ready: function () {\n      window.cy = this;\n    },\n    elements: JSON.parse(cy_data),\n    style: [{\n      selector: \"node\",\n      style: {\n        \"content\": \"data(content)\",\n        \"text-opacity\": 0.7,\n        \"width\": \"auto\",\n        \"height\": \"auto\",\n        \"text-valign\": \"bottom\",\n        \"text-halign\": \"right\",\n        \"text-outline-color\": \"#eee\",\n        \"text-outline-width\": 1\n      }\n    }, {\n      selector: \"[typeshape]\",\n      style: {\n        \"shape\": \"data(typeshape)\"\n      }\n    }, {\n      selector: \"node[typeshape='diamond']\",\n      style: {\n        'background-color': '#CC9900'\n      }\n    }, {\n      selector: \"node[typeshape='diamond'][content='Conflict']\",\n      style: {\n        'background-color': 'red'\n      }\n    }, {\n      selector: \"node[typeshape='diamond'][content='Support']\",\n      style: {\n        'background-color': 'green'\n      }\n    }, {\n      selector: \"edge\",\n      style: {\n        \"line-color\": \"#9dbaea\",\n        \"target-arrow-shape\": \"triangle\",\n        \"target-arrow-color\": \"#9dbaea\",\n        \"curve-style\": \"bezier\"\n      }\n    }, {\n      selector: \":selected\",\n      style: {\n        \"border-width\": \"1\",\n        \"border-color\": \"black\",\n        \"background-color\": \"#3399CC\"\n      }\n    }, {\n      selector: \".atom-label\",\n      style: {\n        \"text-wrap\": \"wrap\",\n        \"text-max-width\": 160\n      }\n    }, {\n      selector: \".scheme-label\",\n      style: {\n        \"text-wrap\": \"wrap\",\n        \"text-max-width\": 160\n      }\n    }],\n    boxSelectionEnabled: false,\n    autounselectify: false,\n    selectionType: \"single\",\n    minZoom: 0.1,\n    maxZoom: 1.5\n  });\n  layout = build_cola_layout();\n  layout.run();\n  cy.elements(\"node[type = \\\"atom\\\"]\").qtip({\n    content: function () {\n      return 'ID: ' + this.id();\n    },\n    position: {\n      my: \"top center\",\n      at: \"bottom center\"\n    },\n    style: {\n      classes: \"qtip-bootstrap\",\n      tip: {\n        width: 16,\n        height: 8\n      }\n    }\n  });\n  cy.edgehandles({\n    toggleOffOnLeave: true,\n    handleNodes: \"node\",\n    handleSize: 10,\n    handleColor: \"orange\",\n    handleHitThreshold: 8,\n    handleLineWidth: 5,\n    //handleLineType: \"flat\",\n    handleOutlineColor: \"grey\",\n    edgeType: function () {\n      return \"flat\";\n    },\n    complete: function (event, sourceNode, targetNode, addedEles) {\n      if (targetNode.length !== 0) {\n        var source_id = targetNode[0].source().id();\n        var target_id = targetNode[0].target().id(); //get the mid point between source node and target node\n\n        var source_position = targetNode[0].source().position();\n        var target_position = targetNode[0].target().position();\n        position = {};\n        position.x = (source_position.x + target_position.x) / 2;\n        position.y = (source_position.y + target_position.y) / 2;\n\n        if (targetNode[0].source().data().type == \"atom\" && targetNode[0].target().data().type == \"atom\") {\n          var scheme = add_scheme(\"Support\");\n          var scheme_id = scheme.id;\n          var scheme_content = scheme.name; //remove the automatically generated edge\n\n          targetNode.remove();\n          cy.add([{\n            group: \"nodes\",\n            data: {\n              id: scheme_id.toString(),\n              content: scheme_content,\n              typeshape: \"diamond\"\n            },\n            classes: \"scheme-label\",\n            locked: false,\n            position: position\n          }]);\n          var edge1 = sadface.add_edge(source_id, scheme_id);\n          var edge2 = sadface.add_edge(scheme_id, target_id);\n          cy.add([{\n            group: \"edges\",\n            data: {\n              id: edge1.id.toString(),\n              source: source_id,\n              target: scheme_id\n            }\n          }, {\n            group: \"edges\",\n            data: {\n              id: edge2.id.toString(),\n              source: scheme_id,\n              target: target_id\n            }\n          }]);\n        } else {\n          targetNode.remove();\n          var edge = sadface.add_edge(source_id, target_id);\n          cy.add([{\n            group: \"edges\",\n            data: {\n              id: edge.id.toString(),\n              source: source_id,\n              target: target_id\n            }\n          }]);\n        }\n\n        update_local_storage();\n      } else {\n        targetNode.remove();\n      }\n    }\n  });\n  /*\n   *\n   * Set up context menus\n   *\n   * */\n\n  cm = cy.contextMenus({\n    menuItems: [{\n      id: \"edit-content\",\n      title: \"edit content\",\n      selector: \"node[type = \\\"atom\\\"]\",\n      onClickFunction: function (event) {\n        var target = event.target || event.cyTarget; // $(\"#editContentModal\").modal(\"show\");\n        //  $(\"#edit_atom_content\").val(target.data().content);\n\n        edit_atom = target;\n      },\n      hasTrailingDivider: false\n    }, {\n      id: \"edit-metadata\",\n      title: \"edit metadata\",\n      selector: \"node[type = \\\"atom\\\"]\",\n      onClickFunction: function (event) {\n        // $(\"#edit_metadata\").empty();\n        var target = event.target || event.cyTarget;\n        var atom = sadface.get_atom(target.id()); // var textArea = $(\"<textarea id=\\\"\"+target.id()+\"_metadata\\\" class=\\\"form-control\\\" rows=\\\"2\\\" >\"+JSON.stringify(atom.metadata)+\"</textarea>\");\n        // $(\"#edit_metadata\").append(textArea);\n        //  $(\"#editMetadataModal\").modal(\"show\");\n\n        edit_atom = target;\n      },\n      hasTrailingDivider: true\n    }, {\n      id: \"change-scheme\",\n      title: \"change scheme\",\n      selector: \"node[typeshape = \\\"diamond\\\"]\",\n      onClickFunction: function (event) {\n        var target = event.target || event.cyTarget; //  $(\"#editSchemeModal\").modal(\"show\");\n\n        edit_atom = target;\n      },\n      hasTrailingDivider: true\n    }, {\n      id: \"remove\",\n      title: \"remove\",\n      selector: \"node, edge\",\n      onClickFunction: function (event) {\n        var target = event.target || event.cyTarget;\n\n        if (selected.length !== 0) {\n          selected.forEach(function (node) {\n            delete_nodes(node);\n          });\n          selected = [];\n        } else {\n          if (target.data().type == \"atom\") {\n            delete_nodes(event);\n            target.remove();\n          } else if (target.data().typeshape == \"diamond\") {\n            delete_nodes(event);\n            target.remove();\n          } else {\n            sadface.delete_edge(target.id());\n            update_local_storage();\n            target.remove();\n          }\n        }\n      },\n      hasTrailingDivider: true\n    }, {\n      id: \"add-atom\",\n      title: \"add atom\",\n      coreAsWell: true,\n      onClickFunction: function (event) {\n        position = event.renderedPosition; //  $(\"#newAtomModal\").modal(\"show\");\n      }\n    }, {\n      id: \"add-scheme\",\n      title: \"add scheme\",\n      coreAsWell: true,\n      onClickFunction: function (event) {\n        position = event.position || event.cyPosition;\n        document.getElementById(\"sel1\").options.selectedIndex = 0; //  $(\"#newSchemeModal\").modal(\"show\");\n      },\n      hasTrailingDivider: true\n    }, {\n      id: \"redraw\",\n      title: \"redraw\",\n      coreAsWell: true,\n      onClickFunction: function (event) {\n        redraw_visualisation();\n      },\n      hasTrailingDivider: true\n    }, {\n      id: \"undo\",\n      title: \"undo\",\n      selector: \"node, edge\",\n      show: false,\n      coreAsWell: true,\n      onClickFunction: function (event) {\n        undo();\n      },\n      hasTrailingDivider: false\n    }, {\n      id: \"redo\",\n      title: \"redo\",\n      selector: \"node, edge\",\n      show: false,\n      coreAsWell: true,\n      onClickFunction: function (event) {\n        redo();\n\n        if (redo_stack == []) {\n          cm.hideMenuItem(\"redo\");\n        }\n      },\n      hasTrailingDivider: true\n    }, {\n      id: \"merge_nodes\",\n      title: \"merge nodes\",\n      selector: \"node\",\n      show: false,\n      coreAsWell: true,\n      onClickFunction: function (event) {\n        merge_nodes();\n      }\n    }]\n  });\n  cy.on(\"unselect\", \"node\", function (e) {\n    selected.pop(e);\n    cm.hideMenuItem(\"merge_nodes\");\n  });\n  cy.on(\"select\", \"node\", function (e) {\n    selected.push(e);\n\n    if (selected.length > 1) {\n      cm.showMenuItem(\"merge_nodes\");\n    } else {\n      cm.hideMenuItem(\"merge_nodes\");\n    }\n  });\n  cy.on(\"tap\", function (e) {//when cytoscape is tapped remove any focus from HTML elements like the tab textareas\n    //this mainly helps with keybinds\n    //        $(\":focus\").blur();\n  });\n  cy.on(\"layoutstart\", function () {\n    running = true;\n  });\n  cy.on(\"layoutstop\", function () {\n    running = false;\n    var png = cy.png({\n      full: true\n    }); //        $('#download_png').attr('href', png);\n\n    var jpg = cy.jpg({\n      full: true\n    }); //        $('#download_jpg').attr('href', jpg);\n  });\n  /*  $(\".resource-pane\").resizable({\n         handleSelector: \".splitter\",\n         resizeHeight: false,\n         resizeWidthFrom: \"right\",\n         //onDragStart: function (e, $el, opt) {},\n         onDragEnd: function (e, $el, opt) {\n             cy.resize();\n         }\n     });*/\n}\n\nfunction build_cola_layout(opts) {\n  var cola_params = {\n    name: \"cola\",\n    animate: true,\n    randomize: true,\n    padding: 100,\n    fit: false,\n    maxSimulationTime: 1500\n  };\n  var i = 0;\n\n  if (opts !== undefined) {\n    opts.forEach(function (opt) {\n      cola_params[i] = opts[i];\n      ++i;\n    });\n  }\n\n  return cy.makeLayout(cola_params);\n}\n\nfunction loadJSON(json_value) {\n  json = sadface.import_json(json_value);\n  localStorage.setItem(\"state\", JSON.stringify(sadface.get_sd()));\n  current_sadface_doc = JSON.stringify(sadface.get_sd()); //load any sources in the stored diagram state\n\n  window.onload = function () {\n    loadTabs(json.resources);\n  };\n\n  cy_data = sadface.export_cytoscape(json);\n\n  if (cy !== null) {\n    cy.elements().remove();\n    cy.json({\n      elements: JSON.parse(cy_data)\n    });\n    redraw_visualisation();\n  }\n}\n\nfunction loadTabs(tabs) {\n  tabs.forEach(function (tab) {\n    sadface.load_tab(tab);\n  });\n}\n/*\n *\n * Model Manipulation Functions\n *\n * */\n\n\nfunction add_new_atom_node(content) {\n  var meta = {\n    \"hello\": \"world\"\n  };\n  var new_atom = sadface.add_atom(content);\n  var atom_id = new_atom.id;\n\n  if (focused != null) {\n    sadface.add_source(atom_id, focused.id, content, 0, 0);\n  }\n\n  if (position == null) {\n    position = {\n      \"x\": cy.width() / 2,\n      \"y\": cy.height() / 2\n    };\n  }\n\n  cy.add([{\n    group: \"nodes\",\n    data: {\n      id: atom_id.toString(),\n      content: content,\n      type: \"atom\",\n      typeshape: \"roundrectangle\",\n      metadata: meta\n    },\n    classes: \"atom-label\",\n    locked: false,\n    renderedPosition: position\n  }]);\n  sadface.node = cy.getElementById(atom_id.toString());\n  sadface.node.qtip({\n    content: function () {\n      return 'ID: ' + this.id();\n    },\n    position: {\n      my: \"top center\",\n      at: \"bottom center\"\n    },\n    style: {\n      classes: \"qtip-bootstrap\",\n      tip: {\n        width: 16,\n        height: 8\n      }\n    }\n  });\n  position = null;\n  update_local_storage();\n}\n\nfunction get_selected_text() {\n  if (document.activeElement.tagName.toLowerCase() == \"textarea\") {\n    var selectedTextArea = document.activeElement;\n    var selection = selectedTextArea.value.substring(selectedTextArea.selectionStart, selectedTextArea.selectionEnd);\n    selectedTextArea.selectionStart = selectedTextArea.selectionEnd;\n  }\n\n  return selection;\n}\n\nfunction clear_selection() {\n  if (window.getSelection) {\n    if (window.getSelection().empty) {\n      // Chrome\n      window.getSelection().empty();\n    }\n\n    if (window.getSelection().removeAllRanges) {\n      // Firefox\n      window.getSelection().removeAllRanges();\n    }\n  }\n\n  if (document.selection) {\n    // IE?\n    document.selection.empty();\n  }\n}\n\nfunction set_focus(element) {\n  focused = document.getElementById(element.id); //.id;\n}\n\nfunction clear_focus() {\n  focused = null;\n}\n\nfunction update_local_storage() {\n  var undo_item = JSON.parse(current_sadface_doc);\n  undo_stack.push(undo_item);\n  redo_stack = [];\n  cm.showMenuItem(\"undo\");\n  cm.hideMenuItem(\"redo\");\n  localStorage.setItem(\"state\", JSON.stringify(sadface.get_sd()));\n  current_sadface_doc = JSON.stringify(sadface.get_sd());\n  sadface.update();\n}\n\nfunction undo() {\n  if (undo_stack.length != 0) {\n    var redo_item = sadface.get_sd();\n    redo_stack.push(redo_item);\n    sadface.state = undo_stack.pop();\n    loadJSON(JSON.stringify(sadface.state));\n\n    if (undo_stack.length == 0) {\n      cm.hideMenuItem(\"undo\");\n    }\n\n    cm.showMenuItem(\"redo\");\n  }\n}\n\nfunction redo() {\n  if (redo_stack.length != 0) {\n    var undo_item = sadface.get_sd();\n    undo_stack.push(undo_item);\n    sadface.state = redo_stack.pop();\n    loadJSON(JSON.stringify(sadface.state));\n\n    if (redo_stack.length == 0) {\n      cm.hideMenuItem(\"redo\");\n    }\n\n    cm.showMenuItem(\"undo\");\n  }\n}\n\nfunction dragover_handler(ev) {\n  ev.preventDefault();\n  ev.dataTransfer.dropEffect = \"move\";\n}\n\nfunction drop_handler(ev) {\n  ev.preventDefault();\n  position = {\n    x: ev.clientX - 280,\n    y: ev.clientY + 200\n  };\n  var selection = get_selected_text();\n\n  if (selection != null || selection != undefined) {\n    add_new_atom_node(selection);\n    clear_selection();\n    clear_focus();\n  } else {\n    console.log(\"Not a valid text selection.\");\n  }\n}\n\nfunction merge_nodes() {\n  //From all currently selected nodes, set first in selected to the base node, move all sources and edges related to each other node in selected to base node\n  var target;\n  var id;\n  var atom;\n  var baseNode = selected[0].target || selected[0].cyTarget;\n  var baseId = baseNode.id();\n  var baseAtom = sadface.get_atom(baseId);\n  var edge;\n\n  if (baseAtom.type == \"atom\") {\n    sadface.sds = sadface.get_sd();\n    var i = 0;\n    selected.forEach(function (node) {\n      var j = 0;\n\n      if (i > 0) {\n        target = selected[i].target || selected[i].cyTarget;\n        id = target.id();\n        atom = sadface.get_atom(id);\n\n        if (atom.type == \"atom\") {\n          atom.sources.forEach(function (source) {\n            sadface.add_source(baseId, atom.sources[j].resource_id, atom.sources[j].text, atom.sources[j].offset, atom.sources[j].length);\n            ++j;\n          });\n          j = 0;\n          sadface.sds.edges.forEach(function (edge) {\n            if (sadface.sds.edges[j].source_id == id) {\n              edge = sadface.add_edge(baseId, sadface.sds.edges[j].target_id);\n              cy.add([{\n                group: \"edges\",\n                data: {\n                  id: edge.id.toString(),\n                  source: baseId,\n                  target: sadface.sds.edges[j].target_id\n                }\n              }]);\n            }\n\n            if (sadface.sds.edges[j].target_id == id) {\n              edge = sadface.add_edge(sadface.sds.edges[j].source_id, baseId);\n              cy.add([]);\n            }\n\n            ++j;\n          });\n          delete_nodes(selected[i]);\n        } else {\n          alert(\"cannot merge scheme nodes\");\n        }\n      }\n\n      ++i;\n    });\n    selected = [];\n    cm.hideMenuItem(\"merge_nodes\");\n  } else {\n    alert(\"cannot merge scheme nodes\");\n  }\n}\n\nfunction edit_atom_content() {\n  var content = document.getElementById(\"edit_atom_content\").value;\n  var atom = cy.$(\"#\" + edit_atom.id());\n  sadface.update_atom_text(edit_atom.id(), content);\n  update_local_storage();\n  atom.data(\"content\", content);\n  edit_atom = null;\n}\n\nfunction edit_atom_metadata() {\n  var atom = cy.$(\"#\" + edit_atom.id());\n  var content = document.getElementById(atom.id() + \"_metadata\").value;\n\n  if (JSON.parse(content)) {\n    var metadata = JSON.parse(content);\n    sadface.update_atom_metadata(atom.id(), metadata);\n    update_local_storage();\n    edit_atom = null;\n  } else {\n    alert(\"Metadata not in JSON format, unable to update\");\n  }\n}\n\nfunction edit_scheme_content() {\n  var scheme_idx = document.getElementById(\"sel2\").options.selectedIndex;\n  var content = document.getElementById(\"sel2\").options[scheme_idx].text;\n  var scheme = cy.$(\"#\" + edit_atom.id());\n  sadface.update_scheme(edit_atom.id(), content);\n  update_local_storage();\n  scheme.data(\"content\", content);\n  edit_atom = null;\n}\n\nfunction clear_local_storage() {\n  localStorage.clear();\n  window.location.reload(false);\n} //******************************************************\n\n\nfunction add_new_scheme_node() {\n  var scheme_idx = document.getElementById(\"sel1\").options.selectedIndex;\n  var scheme = document.getElementById(\"sel1\").options[scheme_idx].text;\n  var new_scheme = sadface.add_scheme(scheme);\n  var scheme_id = new_scheme.id;\n  cy.add([{\n    group: \"nodes\",\n    data: {\n      id: scheme_id.toString(),\n      content: scheme,\n      type: \"scheme\",\n      typeshape: \"diamond\"\n    },\n    classes: \"scheme-label\",\n    locked: false,\n    position: position\n  }]);\n  update_local_storage();\n}\n\nfunction delete_nodes(event) {\n  var target = event.target || event.cyTarget;\n  var id = target.id();\n  sadface.removed = target.remove();\n  sadface.delete_atom(id);\n  var i = 0;\n  var sds = sadface.get_sd();\n  var edges = sds.edges;\n  edges.forEach(function (edge) {\n    if (edges[i] !== undefined) {\n      if (edges[i].source_id === id || edges[i].target_id === id) {\n        sadface.delete_edge(edges[i].id);\n      }\n\n      ++i;\n    }\n  });\n  update_local_storage();\n}\n\nfunction redraw_visualisation() {\n  layout.stop();\n  layout.options.eles = cy.elements();\n  layout.run();\n  cy.center();\n  cy.resize();\n}\n\nfunction mp_reset() {\n  clear_local_storage();\n}\n\nfunction set_analyst_name() {\n  analyst_name = document.getElementById('analyst_name_textarea').value;\n  sadface.update_analyst_name(analyst_name);\n}\n\nfunction set_analyst_email() {\n  analyst_email = document.getElementById('analyst_email_textarea').value;\n  sadface.update_analyst_email(analyst_email);\n}\n\nclass GraphContainer extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {};\n    this.initialise_monkeypuzzle = this.initialise_monkeypuzzle.bind(this);\n  }\n\n  initialise_monkeypuzzle() {\n    //load diagram if there is one in localStorage\n    if (localStorage.getItem(\"state\")) {\n      //  this.loadJSON(localStorage.getItem(\"state\"));\n      this.initCytoscape(); //else use default\n    } else {\n      this.setState({\n        current_sadface_doc: this.setDefault()\n      });\n      localStorage.setItem(\"state\", this.state.current_sadface_doc); //   cy_data = export_cytoscape({import_json(current_sadface_doc)});\n\n      this.initCytoscape();\n    }\n  }\n\n  setDefault() {\n    this.setState({\n      analyst_email: \"Default Analyst Email\",\n      analyst_name: \"Default Analsyst Name\",\n      created: this.props.now(),\n      edges: [],\n      edited: this.props.now(),\n      id: this.props.new_uuid(),\n      metadata: {},\n      nodes: [],\n      resources: []\n    });\n  }\n\n  componentDidMount() {\n    this.initialise_monkeypuzzle();\n    this.setState({\n      cy: this.cy,\n      layout: this.layout,\n      position: this.position\n    });\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      id: \"cy\",\n      ondrop: \"drop_handler(event);\",\n      ondragover: \"dragover_handler(event);\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 780\n      },\n      __self: this\n    });\n  }\n\n}\n\nexport default GraphContainer;","map":{"version":3,"sources":["/Users/gareth/Desktop/monkeypuzzle/src/Components/CytoContainer.js"],"names":["React","Component","cytoscape","cola","edgehandles","now","new_uuid","use","cy","cm","selected","position","layout","running","cy_data","json","created_date","edited_date","analyst_email","analyst_name","document_id","default_sadface_doc","current_sadface_doc","focused","undo_stack","redo_stack","edit_atom","resource_pane_viewable_state","initialise_monkeypuzzle","localStorage","getItem","loadJSON","initCytoscape","setItem","export_cytoscape","import_json","container","document","getElementById","ready","window","elements","JSON","parse","style","selector","boxSelectionEnabled","autounselectify","selectionType","minZoom","maxZoom","build_cola_layout","run","qtip","content","id","my","at","classes","tip","width","height","toggleOffOnLeave","handleNodes","handleSize","handleColor","handleHitThreshold","handleLineWidth","handleOutlineColor","edgeType","complete","event","sourceNode","targetNode","addedEles","length","source_id","source","target_id","target","source_position","target_position","x","y","data","type","scheme","add_scheme","scheme_id","scheme_content","name","remove","add","group","toString","typeshape","locked","edge1","sadface","add_edge","edge2","edge","update_local_storage","contextMenus","menuItems","title","onClickFunction","cyTarget","hasTrailingDivider","atom","get_atom","forEach","node","delete_nodes","delete_edge","coreAsWell","renderedPosition","cyPosition","options","selectedIndex","redraw_visualisation","show","undo","redo","hideMenuItem","merge_nodes","on","e","pop","push","showMenuItem","png","full","jpg","opts","cola_params","animate","randomize","padding","fit","maxSimulationTime","i","undefined","opt","makeLayout","json_value","stringify","get_sd","onload","loadTabs","resources","tabs","tab","load_tab","add_new_atom_node","meta","new_atom","add_atom","atom_id","add_source","metadata","get_selected_text","activeElement","tagName","toLowerCase","selectedTextArea","selection","value","substring","selectionStart","selectionEnd","clear_selection","getSelection","empty","removeAllRanges","set_focus","element","clear_focus","undo_item","update","redo_item","state","dragover_handler","ev","preventDefault","dataTransfer","dropEffect","drop_handler","clientX","clientY","console","log","baseNode","baseId","baseAtom","sds","j","sources","resource_id","text","offset","edges","alert","edit_atom_content","$","update_atom_text","edit_atom_metadata","update_atom_metadata","edit_scheme_content","scheme_idx","update_scheme","clear_local_storage","clear","location","reload","add_new_scheme_node","new_scheme","removed","delete_atom","stop","eles","center","resize","mp_reset","set_analyst_name","update_analyst_name","set_analyst_email","update_analyst_email","GraphContainer","constructor","props","bind","setState","setDefault","created","edited","nodes","componentDidMount","render"],"mappings":"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","sourcesContent":["import React,{Component} from 'react';\nimport cytoscape from 'cytoscape';\nimport cola from 'cytoscape-cola';\nimport edgehandles from 'cytoscape-edgehandles';\n\n//import functions\nimport {\n    now,new_uuid} from '../lib/Sadface';\n\n\n\n\n\n\n\ncytoscape.use( edgehandles );\ncytoscape.use( cola );\n\n\nvar cy = null;\nvar cm = null;\nvar selected = [];\nvar position = null;\nvar layout = null;\nvar running = false;\nvar cy_data  = {};\nvar json;\nvar created_date = now();\nvar edited_date = now();\nvar analyst_email = \"Default Analyst Email\";\nvar analyst_name = \"Default Analsyst Name\";\nvar document_id = new_uuid();\nvar default_sadface_doc = \"{\\\"analyst_email\\\":\\\"\"+analyst_email+\"\\\",\\\"analyst_name\\\":\\\"\"+analyst_email+\"\\\",\\\"created\\\":\\\"\"+created_date+\"\\\",\\\"edges\\\":[],\\\"edited\\\":\\\"\"+edited_date+\"\\\",\\\"id\\\":\\\"\"+document_id+\"\\\",\\\"metadata\\\":{},\\\"nodes\\\":[],\\\"resources\\\": []}\";\nvar current_sadface_doc = null;\nvar focused = null;\nvar undo_stack = [];\nvar redo_stack = [];\nvar edit_atom = null;\nvar resource_pane_viewable_state = true;\n\ninitialise_monkeypuzzle();\n\nfunction initialise_monkeypuzzle() {\n\n    //load diagram if there is one in localStorage\n    if (localStorage.getItem(\"state\"))\n    {\n        loadJSON(localStorage.getItem(\"state\"));\n        initCytoscape();\n    //else use default\n    } else\n    {\n        current_sadface_doc = default_sadface_doc;\n        localStorage.setItem(\"state\", current_sadface_doc);\n        cy_data = export_cytoscape(import_json(current_sadface_doc));\n        initCytoscape();\n    }\n}\n\nfunction initCytoscape() {\n    cy = cytoscape({\n        container: document.getElementById(\"cy\"),\n        ready: function(){ window.cy = this; },\n        elements: JSON.parse(cy_data),\n        style:[\n            {   selector: \"node\", \n                style: {\n                    \"content\": \"data(content)\",\n                    \"text-opacity\": 0.7,\n                    \"width\" : \"auto\",\n                    \"height\" : \"auto\",\n                    \"text-valign\": \"bottom\",\n                    \"text-halign\": \"right\",\n                    \"text-outline-color\": \"#eee\",\n                    \"text-outline-width\": 1\n              }\n            },\n            {   selector: \"[typeshape]\", \n                style: {\n                    \"shape\":\"data(typeshape)\"\n                }\n            },\n            {   selector: \"node[typeshape='diamond']\", \n                style: {\n                    'background-color': '#CC9900'\n                }\n            },\n            {\n                selector: \"node[typeshape='diamond'][content='Conflict']\",\n                style: {\n                    'background-color': 'red'\n                }\n            },\n            {\n                selector: \"node[typeshape='diamond'][content='Support']\",\n                style: {\n                    'background-color': 'green'\n                }\n            },\n            {   selector: \"edge\", \n                style: {\n                    \"line-color\": \"#9dbaea\",\n                    \"target-arrow-shape\": \"triangle\",\n                    \"target-arrow-color\": \"#9dbaea\",\n                    \"curve-style\": \"bezier\"\n                }\n            },\n            {   selector: \":selected\", \n                style: {\n                    \"border-width\":\"1\",\n                    \"border-color\":\"black\",\n                    \"background-color\": \"#3399CC\"\n                }\n            },\n            {   selector: \".atom-label\", \n                style:{\n                    \"text-wrap\": \"wrap\",\n                    \"text-max-width\": 160\n                }\n            },\n            {   selector: \".scheme-label\", \n                style:{\n                    \"text-wrap\": \"wrap\",\n                    \"text-max-width\": 160\n                }\n            }\n            ],\n            boxSelectionEnabled: false,\n            autounselectify: false,\n            selectionType: \"single\",\n            minZoom: 0.1,\n            maxZoom: 1.5\n    });\n\n    layout = build_cola_layout();\n    layout.run();\n\n    cy.elements(\"node[type = \\\"atom\\\"]\").qtip({\n        content: function(){return 'ID: '+this.id()},\n        position: {\n            my: \"top center\",\n            at: \"bottom center\"\n        },\n        style: {\n            classes: \"qtip-bootstrap\",\n            tip: {\n                width: 16,\n                height: 8\n            }\n        }\n    });\n\n\n   cy.edgehandles({\n        toggleOffOnLeave: true,\n        handleNodes: \"node\",\n        handleSize: 10,\n        handleColor: \"orange\",\n        handleHitThreshold: 8,\n        handleLineWidth: 5,\n        //handleLineType: \"flat\",\n        handleOutlineColor: \"grey\",\n        edgeType: function(){ return \"flat\"; },\n        complete: function(event, sourceNode, targetNode, addedEles){\n            if (targetNode.length !== 0) {\n                var source_id = targetNode[0].source().id();\n                var target_id = targetNode[0].target().id();\n\n                //get the mid point between source node and target node\n                var source_position = targetNode[0].source().position();\n                var target_position = targetNode[0].target().position();\n\n                position = {};\n                position.x = ((source_position.x + target_position.x)/2);\n                position.y = ((source_position.y + target_position.y)/2);\n\n                if (targetNode[0].source().data().type == \"atom\" && targetNode[0].target().data().type == \"atom\")\n                {\n                    var scheme = add_scheme(\"Support\");\n                    var scheme_id = scheme.id;\n                    var scheme_content = scheme.name;\n                    //remove the automatically generated edge\n                    targetNode.remove();\n                    cy.add([\n                        {group: \"nodes\", data: {id: scheme_id.toString(),\n                            content: scheme_content, typeshape: \"diamond\" }, classes: \"scheme-label\", locked: false, position: position}\n                    ]);\n                    var edge1 = sadface.add_edge(source_id, scheme_id);\n                    var edge2 = sadface.add_edge(scheme_id, target_id);\n                    cy.add([\n                      { group: \"edges\", data: { id: edge1.id.toString(), source: source_id, target: scheme_id } },\n                      { group: \"edges\", data: { id: edge2.id.toString(), source: scheme_id, target: target_id } }\n                    ]);\n                } else {\n                    targetNode.remove();\n                    var edge = sadface.add_edge(source_id, target_id);\n                    cy.add([\n                      { group: \"edges\", data: { id: edge.id.toString(), source: source_id, target: target_id } }\n                    ]);\n                }\n                update_local_storage();\n            } else {\n                targetNode.remove();\n            }\n        }\n    });\n    /*\n     *\n     * Set up context menus\n     *\n     * */\n    cm = cy.contextMenus({\n        menuItems: [\n          {\n            id: \"edit-content\",\n            title: \"edit content\",\n            selector: \"node[type = \\\"atom\\\"]\",\n            onClickFunction: function (event) {\n              var target = event.target || event.cyTarget;\n             // $(\"#editContentModal\").modal(\"show\");\n            //  $(\"#edit_atom_content\").val(target.data().content);\n              edit_atom = target;\n            },\n            hasTrailingDivider: false\n          },\n          {\n            id: \"edit-metadata\",\n            title: \"edit metadata\",\n            selector: \"node[type = \\\"atom\\\"]\",\n            onClickFunction: function (event) {\n               // $(\"#edit_metadata\").empty();\n                var target = event.target || event.cyTarget;\n                var atom = sadface.get_atom(target.id());\n               // var textArea = $(\"<textarea id=\\\"\"+target.id()+\"_metadata\\\" class=\\\"form-control\\\" rows=\\\"2\\\" >\"+JSON.stringify(atom.metadata)+\"</textarea>\");\n               // $(\"#edit_metadata\").append(textArea);\n              //  $(\"#editMetadataModal\").modal(\"show\");\n                edit_atom = target;\n            },\n            hasTrailingDivider: true\n          },\n          {\n            id: \"change-scheme\",\n            title: \"change scheme\",\n            selector: \"node[typeshape = \\\"diamond\\\"]\",\n            onClickFunction: function (event) {\n                var target = event.target || event.cyTarget;\n              //  $(\"#editSchemeModal\").modal(\"show\");\n                edit_atom = target;\n            },\n            hasTrailingDivider: true\n          },\n          {\n            id: \"remove\",\n            title: \"remove\",\n            selector: \"node, edge\",\n            onClickFunction: function (event) {\n                var target = event.target || event.cyTarget;\n                if (selected.length !== 0) {\n                    selected.forEach(function(node) {\n                        delete_nodes(node);\n                    });\n                    selected = [];\n                } else {\n                    if (target.data().type==\"atom\") {\n                        delete_nodes(event);\n                        target.remove();\n                    } else if (target.data().typeshape==\"diamond\"){\n                        delete_nodes(event);\n                        target.remove();\n                    } else {\n                        sadface.delete_edge(target.id());\n                        update_local_storage();\n                        target.remove();\n                    }\n                }\n            },\n            hasTrailingDivider: true\n          },\n          {\n            id: \"add-atom\",\n            title: \"add atom\",\n            coreAsWell: true,\n            onClickFunction: function (event) {\n                position = event.renderedPosition;\n              //  $(\"#newAtomModal\").modal(\"show\");\n            }\n          },\n          {\n            id: \"add-scheme\",\n            title: \"add scheme\",\n            coreAsWell: true,\n            onClickFunction: function (event) {\n\n                position = event.position || event.cyPosition;\n\n                document.getElementById(\"sel1\").options.selectedIndex=0;\n              //  $(\"#newSchemeModal\").modal(\"show\");\n            },\n            hasTrailingDivider: true\n          },\n          {\n            id: \"redraw\",\n            title: \"redraw\",\n            coreAsWell: true,\n            onClickFunction: function (event) { redraw_visualisation(); },\n            hasTrailingDivider: true\n          },\n          {\n            id: \"undo\",\n            title: \"undo\",\n            selector: \"node, edge\",\n            show: false,\n            coreAsWell: true,\n            onClickFunction: function (event) {\n              undo();\n            },\n            hasTrailingDivider: false\n          },\n          {\n            id: \"redo\",\n            title: \"redo\",\n            selector: \"node, edge\",\n            show: false,\n            coreAsWell: true,\n            onClickFunction: function (event) {\n              redo();\n              if (redo_stack == []) {\n                cm.hideMenuItem(\"redo\");\n              }\n            },\n            hasTrailingDivider: true\n          },\n          {\n              id: \"merge_nodes\",\n              title: \"merge nodes\",\n              selector: \"node\",\n              show: false,\n              coreAsWell: true,\n              onClickFunction: function (event) {\n                  merge_nodes();\n              }\n          }\n        ]\n    });\n\n    cy.on(\"unselect\", \"node\", function (e){\n        selected.pop(e);\n        cm.hideMenuItem(\"merge_nodes\");\n    });\n\n    cy.on(\"select\", \"node\", function (e){\n        selected.push(e);\n        if(selected.length>1) {\n            cm.showMenuItem(\"merge_nodes\");\n        } else {\n            cm.hideMenuItem(\"merge_nodes\");\n        }\n    });\n\n    cy.on(\"tap\", function (e){\n        //when cytoscape is tapped remove any focus from HTML elements like the tab textareas\n        //this mainly helps with keybinds\n//        $(\":focus\").blur();\n    });\n\n    cy.on(\"layoutstart\", function(){\n        running = true;\n    });\n\n    cy.on(\"layoutstop\", function(){\n        running = false;\n        \n        var png = cy.png({ full: true });\n//        $('#download_png').attr('href', png);\n\n        var jpg = cy.jpg({ full: true });\n//        $('#download_jpg').attr('href', jpg);\n    });\n\n /*  $(\".resource-pane\").resizable({\n        handleSelector: \".splitter\",\n        resizeHeight: false,\n        resizeWidthFrom: \"right\",\n        //onDragStart: function (e, $el, opt) {},\n        onDragEnd: function (e, $el, opt) {\n            cy.resize();\n        }\n    });*/\n}\n\nfunction build_cola_layout( opts ) {\n    var cola_params = {\n        name: \"cola\",\n        animate: true,\n        randomize: true,\n        padding: 100,\n        fit: false,\n        maxSimulationTime: 1500\n    };\n    var i = 0;\n    if (opts !== undefined) {\n        opts.forEach(function(opt) {\n           cola_params[i] = opts[i];\n           ++i;\n        });\n    }\n    return cy.makeLayout( cola_params );\n}\n\n\nfunction loadJSON(json_value) {\n    json = sadface.import_json(json_value);\n    localStorage.setItem(\"state\",JSON.stringify(sadface.get_sd()));\n    current_sadface_doc = JSON.stringify(sadface.get_sd());\n    //load any sources in the stored diagram state\n    window.onload = function () {\n        loadTabs(json.resources);\n    };\n    cy_data = sadface.export_cytoscape(json);\n    if(cy !== null)\n    {\n        cy.elements().remove();\n        cy.json({elements: JSON.parse(cy_data)});\n        redraw_visualisation();\n    }\n}\n\nfunction loadTabs(tabs) {\n    tabs.forEach(function(tab) {\n       sadface.load_tab(tab);\n    });\n}\n\n\n/*\n *\n * Model Manipulation Functions\n *\n * */\n\nfunction add_new_atom_node(content) {\n    var meta = {\"hello\":\"world\"};\n    var new_atom = sadface.add_atom(content);\n    var atom_id = new_atom.id;\n    if (focused != null) {\n        sadface.add_source(atom_id, focused.id, content, 0, 0);\n    }\n    if (position == null) {\n        position = {\"x\": cy.width()/2, \"y\": cy.height()/2};\n    }\n    cy.add([\n        {group: \"nodes\", data: {id: atom_id.toString(),\n            content: content, type: \"atom\", typeshape: \"roundrectangle\", metadata: meta }, \n            classes: \"atom-label\", locked: false, renderedPosition: position}\n    ]);\n    sadface.node = cy.getElementById(atom_id.toString() );\n    sadface.node.qtip({\n        content: function(){return 'ID: '+this.id()},\n        position: {\n            my: \"top center\",\n            at: \"bottom center\"\n        },\n        style: {\n            classes: \"qtip-bootstrap\",\n            tip: {\n                width: 16,\n                height: 8\n            }\n        }\n    });\n    position = null;\n    update_local_storage();\n}\n\nfunction get_selected_text() {\n    if(document.activeElement.tagName.toLowerCase() == \"textarea\")\n    {\n        var selectedTextArea = document.activeElement;\n        var selection = selectedTextArea.value.substring(\n            selectedTextArea.selectionStart, selectedTextArea.selectionEnd);\n        selectedTextArea.selectionStart = selectedTextArea.selectionEnd;\n    }\n    return selection;\n}\n\nfunction clear_selection() {\n    if (window.getSelection) {\n        if (window.getSelection().empty) {  // Chrome\n            window.getSelection().empty();\n        } \n        if (window.getSelection().removeAllRanges) {  // Firefox\n            window.getSelection().removeAllRanges();\n        }\n    } \n    if (document.selection) {  // IE?\n        document.selection.empty();\n    }\n}\n\nfunction set_focus(element) {\n    focused = document.getElementById(element.id);//.id;\n}\n\nfunction clear_focus(){\n    focused = null;\n}\n\nfunction update_local_storage() {\n    var undo_item = JSON.parse(current_sadface_doc);\n    undo_stack.push(undo_item);\n    redo_stack = [];\n    cm.showMenuItem(\"undo\");\n    cm.hideMenuItem(\"redo\");\n    localStorage.setItem(\"state\", JSON.stringify(sadface.get_sd()));\n    current_sadface_doc = JSON.stringify(sadface.get_sd());\n    sadface.update();\n}\n\nfunction undo() {\n    if (undo_stack.length != 0) {\n        var redo_item = sadface.get_sd();\n        redo_stack.push(redo_item);\n        sadface.state = undo_stack.pop();\n        loadJSON(JSON.stringify(sadface.state));\n        if (undo_stack.length == 0) {\n            cm.hideMenuItem(\"undo\");\n        }\n        cm.showMenuItem(\"redo\");\n    }\n}\n\nfunction redo() {\n    if (redo_stack.length != 0) {\n        var undo_item = sadface.get_sd();\n        undo_stack.push(undo_item);\n        sadface.state = redo_stack.pop();\n        loadJSON(JSON.stringify(sadface.state));\n        if (redo_stack.length == 0) {\n            cm.hideMenuItem(\"redo\");\n        }\n        cm.showMenuItem(\"undo\");\n    }\n}\n\nfunction dragover_handler(ev) {\n     ev.preventDefault();\n     ev.dataTransfer.dropEffect = \"move\";\n}\n\nfunction drop_handler(ev) {\n    ev.preventDefault();\n    position = {x: ev.clientX-280, y: ev.clientY+200};\n    var selection = get_selected_text();\n    if(selection != null || selection != undefined){\n        add_new_atom_node(selection);\n        clear_selection();\n        clear_focus();\n    }\n    else { console.log(\"Not a valid text selection.\"); }\n}\n\nfunction merge_nodes() {\n    //From all currently selected nodes, set first in selected to the base node, move all sources and edges related to each other node in selected to base node\n    var target;\n    var id;\n    var atom;\n    var baseNode = selected[0].target || selected[0].cyTarget;\n    var baseId = baseNode.id();\n    var baseAtom = sadface.get_atom(baseId);\n    var edge;\n    if (baseAtom.type == \"atom\") {\n        sadface.sds = sadface.get_sd();\n        var i = 0;\n        selected.forEach(function(node){\n            var j = 0;\n            if (i > 0) {\n                target = selected[i].target || selected[i].cyTarget;\n                id = target.id();\n                atom = sadface.get_atom(id);\n                if (atom.type == \"atom\") {\n                    atom.sources.forEach(function(source) {\n                        sadface.add_source(baseId, atom.sources[j].resource_id, atom.sources[j].text, atom.sources[j].offset, atom.sources[j].length);\n                        ++j;\n                    });\n                    j = 0;\n                    sadface.sds.edges.forEach(function(edge) {\n                        if (sadface.sds.edges[j].source_id == id) {\n                            edge = sadface.add_edge(baseId,sadface.sds.edges[j].target_id);\n                            cy.add([\n                              { group: \"edges\", data: { id: edge.id.toString(), source: baseId, target: sadface.sds.edges[j].target_id } }\n                            ]);\n                        }\n                        if (sadface.sds.edges[j].target_id == id) {\n                            edge = sadface.add_edge(sadface.sds.edges[j].source_id, baseId);\n                            cy.add([\n                            ]);\n                        }\n                        ++j;\n                    });\n                delete_nodes(selected[i]);\n                } else {\n                    alert(\"cannot merge scheme nodes\");\n                }\n            }\n            ++i;\n        });\n        selected = [];\n        cm.hideMenuItem(\"merge_nodes\");\n    } else {\n        alert(\"cannot merge scheme nodes\");\n    }\n}\n\nfunction edit_atom_content() {\n    var content = document.getElementById(\"edit_atom_content\").value;\n    var atom = cy.$(\"#\"+edit_atom.id());\n    sadface.update_atom_text(edit_atom.id(), content);\n    update_local_storage();\n    atom.data(\"content\", content);\n    edit_atom = null;\n}\n\nfunction edit_atom_metadata() {\n    var atom = cy.$(\"#\"+edit_atom.id());\n    var content = document.getElementById(atom.id()+\"_metadata\").value;\n    if (JSON.parse(content)) {\n        var metadata = JSON.parse(content);\n        sadface.update_atom_metadata(atom.id(), metadata);\n        update_local_storage();\n        edit_atom=null;\n    } else {\n        alert(\"Metadata not in JSON format, unable to update\");\n    }\n}\n\nfunction edit_scheme_content() {\n    var scheme_idx = document.getElementById(\"sel2\").options.selectedIndex;\n    var content = document.getElementById(\"sel2\").options[scheme_idx].text;\n    var scheme = cy.$(\"#\"+edit_atom.id());\n    sadface.update_scheme(edit_atom.id(), content);\n    update_local_storage();\n    scheme.data(\"content\", content);\n    edit_atom = null;\n}\n\nfunction clear_local_storage() {\n    localStorage.clear();\n    window.location.reload(false);\n}\n//******************************************************\n\nfunction add_new_scheme_node() {\n    var scheme_idx = document.getElementById(\"sel1\").options.selectedIndex;\n    var scheme = document.getElementById(\"sel1\").options[scheme_idx].text;\n    var new_scheme = sadface.add_scheme(scheme);\n    var scheme_id = new_scheme.id;\n\n    cy.add([\n        {group: \"nodes\", data: {id: scheme_id.toString(),\n            content: scheme, type: \"scheme\", typeshape: \"diamond\" }, classes: \"scheme-label\", locked: false, position: position}\n    ]);\n    update_local_storage();\n}\n\nfunction delete_nodes(event) {\n    var target = event.target || event.cyTarget;\n    var id = target.id();\n    sadface.removed = target.remove();\n    sadface.delete_atom(id);\n    var i = 0;\n    var sds = sadface.get_sd();\n    var edges = sds.edges;\n    edges.forEach(function(edge) {\n        if (edges[i] !== undefined) {\n            if (edges[i].source_id === id || edges[i].target_id === id) {\n                sadface.delete_edge(edges[i].id);\n            }\n            ++i;\n        }\n    });\n    update_local_storage();\n}\n\nfunction redraw_visualisation() {\n    layout.stop();\n    layout.options.eles = cy.elements();\n    layout.run();\n    cy.center();\n    cy.resize();\n}\n\nfunction mp_reset()\n{\n    clear_local_storage();\n}\n\nfunction set_analyst_name()\n{\n    analyst_name = document.getElementById('analyst_name_textarea').value;\n    sadface.update_analyst_name(analyst_name);\n}\n\nfunction set_analyst_email()\n{\n    analyst_email = document.getElementById('analyst_email_textarea').value;\n    sadface.update_analyst_email(analyst_email);\n}\n\n\n\n\n\n\nclass GraphContainer extends React.Component{\n    constructor(props){\n        super(props);\n        \n\n        this.state = {\n        \t\n        }\n        this.initialise_monkeypuzzle = this.initialise_monkeypuzzle.bind(this);\n        }\n    \n\n\n    \n\n    initialise_monkeypuzzle(){\n          //load diagram if there is one in localStorage\n        if (localStorage.getItem(\"state\"))\n        {\n          //  this.loadJSON(localStorage.getItem(\"state\"));\n            this.initCytoscape();\n        //else use default\n        } else\n        {\n            this.setState({current_sadface_doc: this.setDefault()})\n            localStorage.setItem(\"state\", this.state.current_sadface_doc);\n         //   cy_data = export_cytoscape({import_json(current_sadface_doc)});\n            this.initCytoscape();\n        }\n    }\n\n\n\n\n   \n\n  setDefault(){\n    this.setState({\n        analyst_email: \"Default Analyst Email\",\n        analyst_name: \"Default Analsyst Name\",\n        created: this.props.now(),\n        edges:[],\n        edited: this.props.now(),\n        id: this.props.new_uuid(),\n        metadata:{},\n        nodes:[],\n        resources: [],\n\n\n\n    });\n}\n\n\n    componentDidMount(){\n        this.initialise_monkeypuzzle();\n        this.setState({\n            cy: this.cy,\n            layout: this.layout,\n            position: this.position,\n        })\n   \n    }\n\n    render(){\n        return(\n            <div id=\"cy\" ondrop=\"drop_handler(event);\" ondragover=\"dragover_handler(event);\"></div>\n        )\n    }\n}\n\n\n\n\nexport default GraphContainer;"]},"metadata":{},"sourceType":"module"}